{"version":3,"sources":["webpack:///./web-server/plugins/slycat-timeseries-model/js/ui.js","webpack:///./node_modules/babel-runtime/core-js/get-iterator.js","webpack:///./node_modules/core-js/library/fn/get-iterator.js","webpack:///./node_modules/core-js/library/modules/core.get-iterator.js","webpack:///./web-server/img/sort-dendrogram.png","webpack:///./web-server/img/sort-dendrogram-selected.png","webpack:///./web-server/plugins/slycat-timeseries-model/js/chunker.js","webpack:///./web-server/js/slycat-job-checker.js","webpack:///./web-server/templates/slycat-job-checker.html","webpack:///./web-server/plugins/slycat-timeseries-model/css/ui.css?6542","webpack:///./web-server/plugins/slycat-timeseries-model/css/ui.css","webpack:///./web-server/plugins/slycat-timeseries-model/js/timeseries-cluster.js","webpack:///./web-server/plugins/slycat-timeseries-model/js/timeseries-controls.js","webpack:///./web-server/plugins/slycat-timeseries-model/js/timeseries-legend.js","webpack:///./web-server/plugins/slycat-timeseries-model/js/timeseries-table.js","webpack:///./web-server/plugins/slycat-timeseries-model/js/timeseries-dendrogram.js","webpack:///./web-server/plugins/slycat-timeseries-model/js/timeseries-waveformplot.js","webpack:///./node_modules/jquery-knob/dist/jquery.knob.min.js","webpack:///./web-server/plugins/slycat-timeseries-model/js/color-switcher.js"],"names":["__webpack_require__","dialog","chunker","$","document","ready","model","_id","_urijs2","default","window","location","segment","bookmarker","bookmark","clusters","clusters_data","waveforms_data","waveforms_metadata","cluster_index","table_metadata","color_array","colorscale","colormap","color_variables","uniqueValues","selected_column","selected_column_type","selected_column_min","selected_column_max","selected_simulations","sort_variable","sort_order","collapsed_nodes","expanded_nodes","selected_nodes","controls_ready","colorswitcher_ready","dendrogram_ready","waveformplot_ready","table_ready","legend_ready","selected_waveform_indexes","image_columns","layout","applyDefaultStyles","north","size","resizable","resizeWhileDragging","west","width","onresize","dendrogram","center","waveformplot","east","legend","height","south","table","s_to_a","s","Array","isArray","JSON","parse","s_to_o","_typeof3","doPoll","ajax","type","url","api_root","success","result","alert","show_checkjob","setTimeout","client","put_model","mid","state","reload","error","bookmark_manager","create","project","hasOwnProperty","console","log","get_model_command","command","media_columns","put_model_parameter","aid","value","input","remove","retrieve_bookmarked_state","getState","undefined","i","length","indexOf","push","unshift","pop","setup_widgets","setup_colordata","text","contentType","artifact_missing","metadata","setup_page","request","status","reason_phrase","jc","children","$jc","detach","append","ko","dataFor","set_jid","css","title","message","retrieve_sorted_column","column","callback","array","parameters","lastColumn","firstRow","lastRow","async","resp","this","get_model_arrayset","cluster_data","controls_options","model_name","highlight","cluster","color-variable","selection","parseInt","controls","bind","event","selected_cluster_changed","variable","selected_variable_changed","colorswitcher","update_current_colorscale","newColormap","toString","gradient","background-color","fill","fill-opacity","update_waveform_dendrogram_table_legend_on_selected_variable_changed","updateState","selected_colormap_changed","label","min","max","v_type","waveformplot_options","waveforms","color_scale","waveform_indexes","selected_simulations_changed","table_options","variable-selection","row-selection","sort-variable","sort-order","order","variable_sort_changed","dendrogram_options","build_dendrogram_node_options","dendrogram_sort_order","nodes","waveform_index","each","index","node","getWaveformIndexes","node_indexes","node_index","getNodeIndexes","skip_bookmarking","selected_node_changed","collapsed","expanded","cluster_state","expanded_collapsed_nodes_changed","node_toggled","update_dendrogram","update_waveformplot","cluster-index","bookmark_selected_simulations","selected_variable","unique","values","module","exports","__esModule","anObject","get","getIterator","it","iterFn","TypeError","call","is_little_endian","get_model_arrayset_metadata","cast_array_buffer","get_model_array_attribute","dfd","Deferred","metadataSuccess","retrieve_model_array_attribute","arrays","always","resolve","get_model_array_attribute_metadata","ranges","range","attribute","isStringAttribute","attributes","byteorder","dimension","dimensions","begin","end","join","XMLHttpRequest","open","responseType","onload","e","buffer","response","responseText","row_count","column_count","send","retrieve_model_arrayset","arrayset_metadata_cache","hyperchunks","split","uri","encodeURIComponent","item","count","results","start","offset","j","name","arrayset_metadata_retrieval_inprogress","arrayset_metadata_callbacks","Uint32Array","Uint8Array","callback_parameters","Int32Array","Int16Array","Int8Array","Uint16Array","Float64Array","Float32Array","components","register","viewModel","params","vm","remote","mapping","fromJS","hostname","username","password","status_type","enable","focus","sid","session_exists","extend","notify","jid","observable","output","iid","previous_state","connect","modal","removeAttr","checkjob","post_remotes","attr","cancel","cancel_pull","routine","get_checkjob","errors","repeated_state","clearInterval","pullDataFromHpc","pullHPCData","setInterval","on","preventDefault","stopPropagation","delete_job","template","slycatJobChecker","content","options","hmr","transform","insertInto","locals","escape","widget","_create","self","select_cluster","element","find","removeClass","addClass","row","appendTo","data","click","context","trigger","click_cluster","hidden_simulations","indices","general_controls","color_control","color_button","color_items","csv_button","filteredHighlight","txt","buttons_save","className","icon_class","filter","el","splice","visibleRows","buttons","button","_write_data_table","openCSVSaveChoiceDialog","_set_color_variables","selectionList","_stringify2","_write_csv","_convert_to_csv","csvData","defaultFilename","blob","Blob","csvUrl","URL","createObjectURL","link","createElement","href","style","download","body","appendChild","removeChild","sl","rowMajorData","_","zip","apply","_lodash2","_toConsumableArray3","sort","at","headers","slice","Papa","unparse","empty","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","_getIterator3","next","done","toggleClass","html","menu_item","parent","hasClass","err","return","_set_selected_color","_cloneArrayBuffer","source","clone","_setOption","key","border","svg","d3","select","legend_layer","legend_axis_layer","updates","update_timer","_schedule_update","update_width","update_height","render_legend","update_legend_colors","update_legend_position","update_legend_axis","update_label","update_color_domain","render_data","render_selection","_update","classed","stop","selectAll","exit","enter","d","color","total_height","rectHeight","transx","transy","legend_scale","scale","linear","domain","ordinal","reverse","rangePoints","legend_axis","axis","orient","y","table_filter","header_class","cell_class","value_formatter","replace","cell_formatter","cell","columnDef","dataContext","hcl","l","make_column","column_index","id","field","sortable","headerCssClass","cssClass","formatter","header","tooltip","columns","resize_canvas","grid","resizeCanvas","set_sort","selectedRows","getSimulationRowIndexes","trigger_row_selection","setSelectedRows","resetActiveCell","scrollRowToTop","Math","_array_equal","_color_variables","data_table_index","initialize_grid","sorted_table_filter","retrieve_table_filter","sorted_rows","plain_array","a","b","_data_provider","sort_column","setData","setGrid","invalidate","Slick","Grid","explicitInitialization","enableColumnReorder","header_buttons","Plugins","HeaderButtons","onCommand","subscribe","args","updateColumnHeader","registerPlugin","AutoTooltips","enableForHeaderCells","setSelectionModel","RowSelectionModel","onSelectedRowsChanged","rows","getDataItem","onHeaderClick","init","onDataLoaded","from","to","invalidateRow","render","variables","getColumns","inArray","ranked_indices","pages","pages_in_progress","page_size","Event","get_indices_old","sortedUnsorted","asynchronous","row_string","get_indices","direction","getLength","getItem_old","column_end","page","floor","page_begin","row_begin","row_end","rowsToRetrieve","getItem","getItemMetadata","simulation_indexes","table_filter_index","sorted_table_filter_element","retrieve_table_filter_index","not","data_table_index_array","_set_cluster","container","linkage","input_indices","exemplars","subtrees","node-index","leaves","exemplar","selected","waveform-index","data-table-index","diagram_width","diagram_height","separation","sortControl","_set_dendrogram_sort_order_state","outputsButtonLabel","outputs_items","_set_outputs","vis","root","x0","y0","max_depth","forEach","depth","toggle","_children","select_node","style_selected_nodes","color_links","find_selected_nodes","path","target","x","select_subtree","checkChildren","update_subtree","duration","altKey","current_depth","expandUpToLevel","level","node_enter","node_subtree","node_glyph","ctrlKey","metaKey","unselect_subtree","prune_tree","selected_state","child_selected_state","subtree","unselect_node","node_sparkline","node_sparkline_path","_handle_highlight","_set_highlight","nice","line","node_update","transition","node_exit","links","insert","o","findExpandedAndCollapsedNodes","_set_color","data_table_indexes","getDataTableIndexesFromChildren","concat","nullWaveformColor","nullWaveformDasharray","hover","padding_top","padding_right","padding_bottom","padding_left","waveformPieContainer","waveformPie","knob","readOnly","displayInput","fgColor","bgColor","thickness","step","waveformSelectionPieContainer","waveformSelectionPie","waveformSelectorPieContainer","waveformSelectorPie","waveformProcessingTimeout","timeoutID","waveformSelectionProcessingTimeout","previewWaveformsTimeout","showWaveformPieContainerTimeout","showWaveformSelectionPieContainerTimeout","showWaveformSelectorPieContainerTimeout","x_axis_layer","y_axis_layer","canvas_datum","position","left","top","canvas_datum_ctx","getContext","alpha","canvas_selection","canvas_selection_ctx","canvas_hover","canvas_hover_ctx","canvas_offscreen","canvas_offscreen_ctx","canvas_picker","canvas_picker_ctx","addEventListener","layerX","layerY","dataPick","getImageData","r","g","RGBtoInt","paths","isPointInStroke","_hover","_selection","visible","_set_visible","_calculate_paths","waveform","current_waveform_length","p","x_min","x_max","y_min","y_max","Path2D","moveTo","lineTo","_stopProcessingWaveforms","x_axis","y_axis","fillStyle","opacity","waveform_subset","lineWidth","color_scale_and_color_array","processWaveformLookup","strokeStyle","int","rgb","intToRGB","stroke","finishedProcessingWaveformsLookup","clearTimeout","hide","waveformsLength","show","_timedProcessArray","coloredLine","setLineDash","drawImage","sourceCanvas","destinationContext","timeout","work","previewWaveforms","inCurrentSelection","clearRect","fillRect","input_index","_stopProcessingWaveformsSelection","items","process","progressControl","windowTimer","todo","Date","shift","val","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","t","n","c","originalEvent","touches","v","cv","w","h","$c","isInit","pColor","dH","cH","eH","rH","relative","relativeWidth","relativeHeight","$div","run","_carve","_configure","_draw","stopper","cursor","lineCap","displayPrevious","inputColor","font","fontWeight","inline","rotation","draw","change","release","format","parseFloat","flip","is","_validate","wrap","before","G_vmlCanvasManager","initElement","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","Object","copy","_listen","_xy","clear","_touch","xy2val","pageX","pageY","unbind","_mouse","keyCode","listen","resize","h2rgba","_clear","round","substring","Dial","startAngle","xy","radius","cursorExt","w2","PI2","PI","angleOffset","angleArc","atan2","u","detail","wheelDeltaX","wheelDeltaY","f","37","38","39","40","String","fromCharCode","isNaN","match","endAngle","abs","vertical-align","margin-top","margin-left","background","text-align","padding","-webkit-appearance","visibility","angle","arc","beginPath","fn","dial","color_maps","night","null_color","colors","day","rainbow","rainbow_day","list","gradient_data","get_gradient_data","color_stops","background_color","get_background","background-image","background-size","background-position","background-repeat","padding-right","get_null_color","get_opacity","get_color_scale","domain_scale","get_color_map","get_color_scale_ordinal","tempOrdinal","tempColorscale","rgbRange","get_color_map_ordinal","setUpColorMapsForAllColumns","colorMap","columnMin","columnMax"],"mappings":"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","file":"ui_timeseries_module.js","sourcesContent":["/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract\n DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government\n retains certain rights in this software. */\n\nimport jquery_ui_css from \"jquery-ui/themes/base/jquery-ui.css\";\nimport slick_grid_css from \"css/slickgrid/slick.grid.css\";\nimport slick_default_theme_css from \"css/slickgrid/slick-default-theme.css\";\nimport slick_headerbuttons_css from \"css/slickgrid/slick.headerbuttons.css\";\nimport slick_slycat_theme_css from \"css/slick-slycat-theme.css\";\nimport ui_css from \"../css/ui.css\";\n\nimport api_root from \"js/slycat-api-root\";\nimport ko from \"knockout\";\nimport client from \"js/slycat-web-client\";\nimport bookmark_manager from \"js/slycat-bookmark-manager\";\nimport * as dialog from \"js/slycat-dialog\";\nimport URI from \"urijs\";\nimport * as chunker from \"./chunker\";\nimport \"./timeseries-cluster\";\nimport \"./timeseries-controls\";\nimport \"./timeseries-legend\";\nimport \"./timeseries-table\";\nimport \"./timeseries-dendrogram\";\nimport \"./timeseries-waveformplot\";\nimport \"./color-switcher\";\nimport \"jquery-ui\";\nimport \"js/jquery.layout-latest.min\";\nimport \"js/slycat-navbar\";\nimport \"js/slycat-job-checker\";\n\n// Wait for document ready\n$(document).ready(function() {\n\n  //////////////////////////////////////////////////////////////////////////////////////////\n  // Setup global variables.\n  //////////////////////////////////////////////////////////////////////////////////////////\n\n  var model = { _id: URI(window.location).segment(-1) };\n  var cluster_bin_count = null;\n  var cluster_bin_type = null;\n  var cluster_type = null;\n\n  var bookmarker = null;\n  var bookmark = null;\n\n  var clusters = null; // This is just the list of cluster names\n  var clusters_data = null; // This holds data for each cluster\n  var waveforms_data = null; // This holds the waveforms for each cluster\n  var waveforms_metadata = null; // This holds the waveforms metadata for each cluster\n  var cluster_index = null;  // This holds the index of the currently selected cluster\n  var table_metadata = null;\n\n  var color_array = null; // This holds the sorted array of values for the color scale\n  var colorscale = null; // This holds the current color scale\n  var colormap = null; // This hold the current color map\n  var color_variables = null; // This holds the indexes of all the color variables\n  var uniqueValues = null; // This holds the column's unique values for last selected string column\n\n  var selected_column = null; // This holds the currently selected column\n  var selected_column_type = null;  // This holds the data type of the currently selected column\n  var selected_column_min = null; // This holds the min value of the currently selected column\n  var selected_column_max = null; // This holds the max value of the currently selected column\n  var selected_simulations = null; // This hold the currently selected rows\n\n  var sort_variable = null; // This holds the sorted variable\n  var sort_order = null; // This holds the sort order\n\n  var collapsed_nodes = null; // This holds the collapsed nodes\n  var expanded_nodes = null; // This holds the expanded nodes\n  var selected_nodes = null; // This holds the selected nodes\n\n  var controls_ready = false;\n  var colorswitcher_ready = false;\n  var dendrogram_ready = false;\n  var waveformplot_ready = false;\n  var table_ready = false;\n  var legend_ready = false;\n\n  var selected_waveform_indexes = null;\n\n  var image_columns = null; // This holds the media columns\n\n  //////////////////////////////////////////////////////////////////////////////////////////\n  // Setup page layout and forms.\n  //////////////////////////////////////////////////////////////////////////////////////////\n\n  // Setup the resizing layout ...\n  var bodyLayout = $(\"#timeseries-model\").layout({\n    applyDefaultStyles: false,\n    north :\n    {\n      size: 28,\n      resizable: false,\n      resizeWhileDragging : false,\n    },\n    west :\n    {\n      size : $(\"#timeseries-model\").width() / 2,\n      resizeWhileDragging : false,\n      onresize: function()\n      {\n        $(\"#dendrogram-viewer\").dendrogram(\"resize_canvas\");\n      },\n    },\n    center :\n    {\n      resizeWhileDragging: false,\n      onresize: function()\n      {\n        $(\"#waveform-viewer\").waveformplot(\"resize_canvas\");\n      },\n    },\n    east:\n    {\n      size: 130,\n      resizeWhileDragging: false,\n      onresize: function() { $(\"#legend\").legend(\"option\", {width: $(\"#legend-pane\").width(), height: $(\"#legend-pane\").height()}); },\n    },\n    south:\n    {\n      size: $(\"#timeseries-model\").height() / 3,\n      resizeWhileDragging : false,\n      onresize: function()\n      {\n        $(\"#table\").table(\"resize_canvas\");\n      },\n    },\n  });\n\n  //////////////////////////////////////////////////////////////////////////////////////////\n  // Get the model\n  //////////////////////////////////////////////////////////////////////////////////////////\n  function doPoll() {\n    $.ajax(\n    {\n      type : \"GET\",\n      url : api_root + \"models/\" + model._id,\n      success : function(result)\n      {\n        model = result;\n        // If the model isn't ready or failed, we're done.\n        if(model[\"state\"] === \"closed\" && model[\"result\"] === null)\n        {\n            window.alert(\"model failed to complete possibly the connection was terminated to the hpc client try pulling data\");\n            show_checkjob();\n            setTimeout(doPoll, 15000);\n        }\n\n        if(model[\"state\"] === \"finished\")\n        {\n          client.put_model(\n          {\n            mid: model._id,\n            state: \"closed\",\n            success : function()\n            {\n              window.location.reload(true);\n            },\n            error: function()\n            {\n              window.location.reload(true);\n            }\n          });\n        }\n\n        if(model[\"state\"] === \"closed\" && model[\"result\"] === \"succeeded\")\n        {\n          bookmarker = bookmark_manager.create(model.project, model._id);\n          cluster_bin_count = model[\"artifact:cluster-bin-count\"];\n          cluster_bin_type = model[\"artifact:cluster-bin-type\"];\n          cluster_type = model[\"artifact:cluster-type\"];\n          // Check if model has the image-columns artifact and create one if it doesn't\n          if(!model.hasOwnProperty(\"artifact:image-columns\"))\n          {\n            // Find media columns\n            console.log(\"This model has no artifact:image-columns\");\n            client.get_model_command({\n              mid: model._id,\n              type: \"timeseries\",\n              command: \"media-columns\",\n              success: function(media_columns) {\n                // console.log(\"here are the media_columns: \" + media_columns);\n                client.put_model_parameter({\n                  mid: model._id,\n                  aid: \"image-columns\",\n                  value: media_columns,\n                  input: true,\n                  success: function() {\n                    // console.log(\"successfully saved image-columns\");\n                    image_columns = media_columns;\n                  }\n                });\n              },\n              error: function(error) {\n                console.log(\"error getting model command\");\n              }\n            });\n          }\n          else\n          {\n            image_columns = model[\"artifact:image-columns\"];\n          }\n          $('.slycat-job-checker').remove();\n\n          if(model[\"result\"] == \"failed\")\n            return;\n          setup_page();\n        }\n        else\n        {\n          show_checkjob();\n          setTimeout(doPoll, 15000);\n        }\n      },\n      error: function(request, status, reason_phrase)\n      {\n        window.alert(\"Error retrieving model: \" + reason_phrase);\n      }\n    });\n  }\n  doPoll();\n\n  //////////////////////////////////////////////////////////////////////////////////////////\n  // If the model is ready, start retrieving data, including bookmarked state.\n  //////////////////////////////////////////////////////////////////////////////////////////\n\n  function s_to_a(s) {\n    if (Array.isArray(s))\n      return s;\n    else\n      return JSON.parse(s);\n  }\n\n  function s_to_o(s) {\n    if (typeof(s) === \"object\")\n      return s;\n    else\n      return JSON.parse(s);\n  }\n\n  var show_checkjob = function() {\n    var jc = $('#timeseries-model').children()[0];\n    var $jc = $(jc);\n    $jc.detach();\n\n    $($('#timeseries-model').children()).remove();\n    $('#timeseries-model').append($jc);\n\n    var vm = ko.dataFor($('.slycat-job-checker')[0]);\n    vm.set_jid(model['artifact:jid']);\n  };\n\n  function setup_page()\n  {\n\n    // Display progress as the load happens ...\n    $(\".load-status\").text(\"Loading data.\");\n\n    // Load list of clusters.\n    $.ajax({\n      url : api_root + \"models/\" + model._id + \"/files/clusters\",\n      contentType : \"application/json\",\n      success: function(result)\n      {\n        clusters = result;\n        clusters_data = new Array(clusters.length);\n        waveforms_data = new Array(clusters.length);\n        waveforms_metadata = new Array(clusters.length);\n        setup_widgets();\n        retrieve_bookmarked_state();\n      },\n      error: artifact_missing\n    });\n\n    // Load data table metadata.\n    $.ajax({\n      url : api_root + \"models/\" + model._id + \"/tables/inputs/arrays/0/metadata?index=Index\",\n      contentType : \"application/json\",\n      success: function(metadata)\n      {\n        table_metadata = metadata;\n        setup_widgets();\n        setup_colordata();\n        retrieve_bookmarked_state();\n      },\n      error: artifact_missing\n    });\n\n    // Retrieve bookmarked state information ...\n    function retrieve_bookmarked_state(){\n      if(table_metadata !== null && clusters !== null)\n      {\n        bookmarker.getState(function(state)\n        {\n          bookmark = state;\n\n          // Set state of selected cluster\n          cluster_index = bookmark[\"cluster-index\"] !== undefined ? bookmark[\"cluster-index\"] : 0;\n\n          // Set state of selected simulations\n          selected_simulations = [];\n          if(\"simulation-selection\" in bookmark)\n            selected_simulations = bookmark[\"simulation-selection\"];\n          else if(\"cluster-index\" in bookmark && (bookmark[\"cluster-index\"] + \"-selected-row-simulations\") in bookmark)\n          {\n            selected_simulations = bookmark[bookmark[\"cluster-index\"] + \"-selected-row-simulations\"];\n          }\n\n          // Set state of selected column\n          selected_column = [];\n          selected_column_type = [];\n          selected_column_min = [];\n          selected_column_max = [];\n          for(var i=0; i < clusters.length; i++)\n          {\n            selected_column[i] = bookmark[i + \"-column-index\"] !== undefined ? bookmark[i + \"-column-index\"] : table_metadata[\"column-count\"]-1;\n            selected_column_type[i] = table_metadata[\"column-types\"][selected_column[i]];\n            selected_column_min[i] = table_metadata[\"column-min\"][selected_column[i]];\n            selected_column_max[i] = table_metadata[\"column-max\"][selected_column[i]];\n          }\n\n          // Set state of color variable\n          color_variables = [];\n          for(var i = 0; i < table_metadata[\"column-count\"]; i++)\n          {\n            if(image_columns != undefined && image_columns.indexOf(i) == -1)\n              color_variables.push(i);\n          }\n          // Move index column to top\n          color_variables.unshift(color_variables.pop());\n\n          // Set state of selected waveform indexes\n          selected_waveform_indexes = [];\n          for(var i=0; i < clusters.length; i++)\n          {\n            selected_waveform_indexes[i] = bookmark[i + \"-selected-waveform-indexes\"] !== undefined ? bookmark[i + \"-selected-waveform-indexes\"] : null;\n          }\n\n          // Set state of colormap\n          colormap = bookmark[\"colormap\"] !== undefined ? bookmark[\"colormap\"] : \"night\";\n\n          // Set sort variable and order\n          sort_variable = bookmark[\"sort-variable\"] != undefined ? bookmark[\"sort-variable\"] : undefined;\n          sort_order = bookmark[\"sort-order\"] != undefined ? bookmark[\"sort-order\"] : undefined;\n\n          // Set collapsed, expanded, and selected nodes\n          collapsed_nodes = [];\n          expanded_nodes = [];\n          selected_nodes = [];\n          for(var i=0; i < clusters.length; i++)\n          {\n            collapsed_nodes[i] = bookmark[i + \"-collapsed-nodes\"];\n            expanded_nodes[i] = bookmark[i + \"-expanded-nodes\"];\n            selected_nodes[i] = bookmark[i + \"-selected-nodes\"];\n          }\n\n          setup_widgets();\n          setup_colordata();\n        });\n      }\n    }\n  }\n\n  function artifact_missing()\n  {\n    $(\".load-status\").css(\"display\", \"none\");\n\n    dialog.dialog(\n    {\n      title: \"Load Error\",\n      message: \"Oops, there was a problem retrieving data from the model. This likely means that there was a problem during computation.\",\n    });\n  }\n\n  //////////////////////////////////////////////////////////////////////////////////////////\n  // Setup the rest of the UI as data is received.\n  //////////////////////////////////////////////////////////////////////////////////////////\n\n  function setup_colordata()\n  {\n    if(bookmark && table_metadata && selected_column != null && cluster_index !== null)\n    {\n      retrieve_sorted_column({\n        column : selected_column[cluster_index],\n        callback : function(array){\n          setup_widgets();\n        },\n      });\n    }\n  }\n\n  // Retrieve a column of data, sorted by the index. Saves it in color_array and executes callback, passing the column data array to it.\n  function retrieve_sorted_column(parameters)\n  {\n    //Grabbing all values for current column\n    var lastColumn = table_metadata[\"column-count\"]-1;\n    var firstRow = table_metadata[\"column-min\"][lastColumn];\n    var lastRow  = table_metadata[\"column-max\"][lastColumn]+1;\n\n    $.ajax({\n      url : api_root + \"models/\" + model._id + \"/tables/inputs/arrays/0/chunk?rows=\" + firstRow + \"-\" + lastRow + \"&columns=\" + parameters.column + \"&index=Index&sort=\" + lastColumn + \":ascending\",\n      async: true,\n      callback: parameters.callback,\n      success: function(resp){\n        color_array = resp[\"data\"][0];\n        this.callback(resp[\"data\"][0]);\n      },\n      error: function(request, status, reason_phrase){\n        window.alert(\"Error getting color coding values from table-chunker worker: \" + reason_phrase);\n      }\n    });\n  }\n\n  function setup_widgets()\n  {\n    // Setup waveforms ...\n    if(\n        bookmark && s_to_a(clusters) && cluster_index !== null && waveforms_data[cluster_index] === undefined \n        && waveforms_metadata[cluster_index] === undefined\n      )\n    {\n      waveforms_data[cluster_index] = null;\n      waveforms_metadata[cluster_index] = null;\n      \n      // Load the waveforms.\n      chunker.get_model_arrayset({\n        api_root : api_root + \"\",\n        mid : model._id,\n        aid : \"preview-\" + s_to_a(clusters)[cluster_index],\n        success : function(result, metadata)\n        {\n          waveforms_data[cluster_index] = result;\n          waveforms_metadata[cluster_index] = metadata;\n          setup_widgets();\n        },\n        error : artifact_missing\n      });\n    }\n\n    // Setup clusters data ...\n    if(bookmark && s_to_a(clusters) && clusters_data[cluster_index] === undefined)\n    { \n      clusters_data[cluster_index] = null;\n      $.ajax(\n      {\n        url : api_root + \"models/\" + model._id + \"/files/cluster-\" + s_to_a(clusters)[cluster_index],\n        contentType : \"application/json\",\n        success : function(cluster_data)\n        {\n          clusters_data[cluster_index] = cluster_data;\n          setup_widgets();\n        },\n        error: artifact_missing\n      });\n    }\n\n    // Setup controls ...\n    if(\n        !controls_ready && bookmark && s_to_a(clusters) && (cluster_index !== null)\n        && (selected_simulations != null) && table_metadata && color_variables !== null\n        && selected_waveform_indexes !== null && selected_column !== null && cluster_index !== null\n      )\n    {\n      controls_ready = true;\n\n      $(\"#cluster-pane .load-status\").css(\"display\", \"none\");\n\n      var controls_options =\n      {\n        mid : model._id,\n        model_name: window.model_name,\n        aid : \"inputs\",\n        metadata: table_metadata,\n        highlight: selected_simulations,\n        clusters: s_to_a(clusters),\n        cluster: cluster_index,\n        color_variables: color_variables,\n        \"color-variable\" : selected_column[cluster_index],\n        \"selection\" : selected_waveform_indexes[parseInt(cluster_index, 10)],\n        image_columns : image_columns,\n      };\n\n      $(\"#controls\").controls(controls_options);\n\n      // Changes to the cluster selection ...\n      $(\"#controls\").bind(\"cluster-changed\", function(event, cluster)\n      {\n        // Handle changes to the cluster selection ...\n        selected_cluster_changed(cluster);\n      });\n\n      // Changes to the waveform color ...\n      $(\"#controls\").bind(\"color-selection-changed\", function(event, variable)\n      {\n        variable = parseInt(variable);\n        selected_variable_changed(variable);\n        $(\"#table\").table(\"option\", \"variable-selection\", [selected_column[cluster_index]]);\n      });\n    }\n\n    // Setup the color switcher ...\n    if(!colorswitcher_ready && bookmark && colormap !== null)\n    {\n      colorswitcher_ready = true;\n      $(\"#color-switcher\").colorswitcher({colormap:colormap});\n\n      update_current_colorscale(setup_widgets);\n\n      $(\"#color-switcher\").bind(\"colormap-changed\", function(event, newColormap)\n      {\n        selected_colormap_changed(newColormap);\n      });\n    }\n\n    // Setup the legend ...\n    if( \n        !legend_ready && bookmark && table_metadata && cluster_index !== null && colormap !== null && selected_column !== null \n        && selected_column_type !== null && colorscale !== null\n      )\n    {\n      legend_ready = true;\n\n      $(\"#legend-pane .load-status\").css(\"display\", \"none\");\n\n      $(\"#legend-pane\").css(\"background\", $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString());\n\n      $(\"#legend\").legend({\n        width: $(\"#legend-pane\").width(),\n        height: $(\"#legend-pane\").height(),\n        gradient: $(\"#color-switcher\").colorswitcher(\"get_gradient_data\", colormap),\n        label: table_metadata[\"column-names\"][selected_column[cluster_index]],\n        min: table_metadata[\"column-min\"][selected_column[cluster_index]],\n        max: table_metadata[\"column-max\"][selected_column[cluster_index]],\n        v_type: selected_column_type[cluster_index],\n        uniqueValues : uniqueValues,\n      });\n    }\n\n    // Setup the waveform plot ...\n    if(\n        !waveformplot_ready && bookmark && (cluster_index !== null) && (waveforms_data !== null) && (waveforms_data[cluster_index] !== undefined && waveforms_data[cluster_index] !== null)\n        && color_array !== null && colorscale !== null && table_metadata !== null && selected_simulations !== null && selected_waveform_indexes !== null\n      )\n    {\n      waveformplot_ready = true;\n\n      $(\"#waveform-pane .load-status\").css(\"display\", \"none\");\n\n      $(\"#waveform-pane\").css({\n        \"background-color\" : $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString(),\n        });\n      $(\"#waveform-viewer rect.selectionMask\").css({\n        \"fill\"             : $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString(),\n        \"fill-opacity\"     : $(\"#color-switcher\").colorswitcher(\"get_opacity\", colormap),\n        });\n\n      var waveformplot_options =\n      {\n        mid : model._id,\n        waveforms: waveforms_data[cluster_index],\n        color_scale: colorscale,\n        color_array: color_array,\n        highlight: selected_simulations,\n        \"selection\" : selected_waveform_indexes[parseInt(cluster_index, 10)],\n      };\n\n      $(\"#waveform-viewer\").waveformplot(waveformplot_options);\n\n      // Changing the waveform selection ...\n      $(\"#waveform-viewer\").bind(\"waveform-selection-changed\", function(event, waveform_indexes)\n      {\n        // Log changes to the waveform selection\n        selected_simulations_changed(waveform_indexes);\n        // Updates the dendrogram ...\n        $(\"#dendrogram-viewer\").dendrogram(\"option\", \"highlight\", waveform_indexes);\n        // Updates the controls ...\n        $(\"#controls\").controls(\"option\", \"highlight\", waveform_indexes);\n        // Updates the table row selection ...\n        $(\"#table\").table(\"option\", \"row-selection\", waveform_indexes);\n      });\n    }\n\n    // Setup the table ...\n    if( \n        !table_ready && bookmark && table_metadata && cluster_index !== null && selected_simulations !== null && colormap !== null && colorscale !== null\n        && selected_column !== null && selected_column_type !== null && selected_column_min !== null && selected_column_max !== null\n        && sort_variable !== null && sort_order !== null && image_columns !== null\n      )\n    {\n      table_ready = true;\n\n      $(\"#table-pane .load-status\").css(\"display\", \"none\");\n\n      var table_options =\n      {\n        api_root : api_root,\n        mid : model._id,\n        aid : \"inputs\",\n        metadata : table_metadata,\n        colorscale : colorscale,\n        colormap : colormap,\n        \"variable-selection\" : [selected_column[cluster_index]],\n        \"row-selection\" : selected_simulations,\n        \"sort-variable\" : sort_variable,\n        \"sort-order\" : sort_order,\n        image_columns : image_columns,\n      };\n\n      $(\"#table\").table(table_options);\n\n      // Changing the table row selection ...\n      $(\"#table\").bind(\"row-selection-changed\", function(event, waveform_indexes)\n      {\n        // Log changes to the table row selection\n        selected_simulations_changed(waveform_indexes);\n        // Update the controls ...\n        $(\"#controls\").controls(\"option\", \"highlight\", waveform_indexes);\n        // Update the waveform plot ...\n        $(\"#waveform-viewer\").waveformplot(\"option\", \"highlight\", waveform_indexes);\n        // Changing the table row selection updates the dendrogram ...\n        $(\"#dendrogram-viewer\").dendrogram(\"option\", \"highlight\", waveform_indexes);\n      });\n\n      // Changing table's sort order ...\n      $(\"#table\").bind(\"variable-sort-changed\", function(event, variable, order)\n      {\n        // Log changes to the table sort order ...\n        variable_sort_changed(variable, order);\n        // Updated the dendrogram sort control\n        $(\"#dendrogram-viewer\").dendrogram(\"option\", \"dendrogram_sort_order\", variable == null && order == null ? true : false);\n      });\n\n      // Changing the table variable selection logs it, updates the waveform plot and dendrogram...\n      $(\"#table\").bind(\"variable-selection-changed\", function(event, parameters)\n      {\n        selected_variable_changed(parameters.variable[0]);\n        $(\"#controls\").controls(\"option\", \"color-variable\", selected_column[cluster_index]);\n      });\n    }\n\n    // Setup the dendrogram ...\n    if(\n        !dendrogram_ready && bookmark && s_to_a(clusters) && cluster_index !==  null && clusters_data[cluster_index] !== undefined && clusters_data[cluster_index] !== null\n        && color_array !== null && colorscale !== null && selected_simulations !== null && colormap !== null && selected_column_min !== null && selected_column_max !== null\n        && sort_variable !== null\n      )\n    {\n      dendrogram_ready = true;\n\n      $(\"#dendrogram-pane .load-status\").css(\"display\", \"none\");\n\n      $(\"#dendrogram-sparkline-backdrop\").css({\n        \"background-color\" : $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString(),\n        });\n\n      var dendrogram_options = build_dendrogram_node_options(cluster_index);\n      dendrogram_options.api_root = api_root;\n      dendrogram_options.mid = model._id;\n      dendrogram_options.clusters = s_to_a(clusters);\n      dendrogram_options.cluster_data = s_to_o(clusters_data[cluster_index]);\n      dendrogram_options.color_scale = colorscale;\n      dendrogram_options.color_array = color_array;\n\n      if(sort_variable != undefined) {\n        dendrogram_options.dendrogram_sort_order = false;\n      }\n\n      // Respond to note selection changes. This needs to be above the instantiation of the dendrogram\n      // because the table needs to know which node is selected in order for it to initialize. If this\n      // event handler is registered after the dendrogram is initialized, its first node-selection-changed\n      // event never makes it to the table and we end up with a blank table.\n      $(\"#dendrogram-viewer\").bind(\"node-selection-changed\", function(event, parameters)\n      {\n        selected_node_changed(parameters);\n      });\n\n      $(\"#dendrogram-viewer\").dendrogram(dendrogram_options);\n\n      // Bookmark changes to expanded and collapsed nodes ...\n      $(\"#dendrogram-viewer\").bind(\"expanded-collapsed-nodes-changed\", function(event, nodes)\n      {\n        expanded_collapsed_nodes_changed(nodes);\n      });\n\n      // Log changes to node toggle ...\n      $(\"#dendrogram-viewer\").bind(\"node-toggled\", function(event, node)\n      {\n        node_toggled(node);\n      });\n\n      // Changing the dendrogram waveform selection ...\n      $(\"#dendrogram-viewer\").bind(\"waveform-selection-changed\", function(event, waveform_indexes)\n      {\n        // Log changes to the waveform selection\n        selected_simulations_changed(waveform_indexes);\n        // Update the controls ...\n        $(\"#controls\").controls(\"option\", \"highlight\", waveform_indexes);\n        // Update the waveform plot ...\n        $(\"#waveform-viewer\").waveformplot(\"option\", \"highlight\", waveform_indexes);\n        // Update the table row selection ...\n        $(\"#table\").table(\"option\", \"row-selection\", waveform_indexes);\n      });\n\n      // Changing the sort order to dendrogram order updates the table ...\n      $(\"#dendrogram-viewer\").bind(\"sort-by-dendrogram-order\", function(event){\n        $(\"#table\").table(\"option\", \"sort-variable\", null);\n      });\n\n      // Changes to the cluster selection ...\n      $(\"#dendrogram-viewer\").bind(\"cluster-changed\", function(event, cluster)\n      {\n        // Handle changes to the cluster selection ...\n        selected_cluster_changed(cluster);\n      });\n    }\n  }\n\n  //////////////////////////////////////////////////////////////////////////////////////////\n  // Event handlers.\n  //////////////////////////////////////////////////////////////////////////////////////////\n\n  function selected_colormap_changed(newColormap)\n  {\n    colormap = newColormap;\n\n    // First we change background colors, gradients, and other things that don't require recalculating the colorscale\n    $(\"#legend-pane\").css(\"background\", $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString());\n    $(\"#legend\").legend(\"option\", {gradient: $(\"#color-switcher\").colorswitcher(\"get_gradient_data\", colormap)});\n\n    $(\"#dendrogram-sparkline-backdrop\").css({\n      \"background-color\" : $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString(),\n      });\n\n    $(\"#waveform-pane\").css({\n      \"background-color\" : $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString(),\n      });\n    $(\"#waveform-viewer rect.selectionMask\").css({\n      \"fill\"             : $(\"#color-switcher\").colorswitcher(\"get_background\", colormap).toString(),\n      \"fill-opacity\"     : $(\"#color-switcher\").colorswitcher(\"get_opacity\", colormap),\n      });\n\n    // Now we get the new colorscale and update components\n    update_waveform_dendrogram_table_legend_on_selected_variable_changed();\n\n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"events/models/\" + model._id + \"/select/colormap/\" + colormap\n    });\n    bookmarker.updateState({\"colormap\" : colormap});\n  }\n\n  function selected_cluster_changed(cluster)\n  {\n    cluster_index = cluster;\n\n    // Changing the cluster updates the dendrogram and waveformplot ...\n    update_dendrogram(cluster_index);\n    update_waveformplot(cluster_index);\n\n    // Changing the cluster updates the table variable selection ...\n    $(\"#table\").table(\"option\", \"variable-selection\", [selected_column[cluster_index]]);\n    $(\"#controls\").controls(\"option\", \"color-variable\", selected_column[cluster_index]);\n    update_waveform_dendrogram_table_legend_on_selected_variable_changed();\n\n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"events/models/\" + model._id + \"/select/cluster/\" + cluster_index\n    });\n    bookmarker.updateState({\"cluster-index\" : cluster_index});\n  }\n\n  function selected_node_changed(parameters)\n  {\n    selected_waveform_indexes[parseInt(cluster_index, 10)] = getWaveformIndexes(parameters.selection);\n    selected_nodes[cluster_index] = getNodeIndexes(parameters.selection);\n\n    // Only want to update the controls if the user changed the selected node. It's automatically set at dendrogram creation time, and we want to avoid updating the controls at that time.\n    // Only want to update the waveform plot if the user changed the selected node. It's automatically set at dendrogram creation time, and we want to avoid updating the waveform plot at that time.\n    if(parameters.skip_bookmarking != true) {\n      // Changing the selected dendrogram node updates the controls ...\n      $(\"#controls\").controls(\"option\", \"selection\", selected_waveform_indexes[parseInt(cluster_index, 10)]);\n      $(\"#controls\").controls(\"option\", \"highlight\", selected_simulations);\n\n      // Changing the selected dendrogram node updates the waveform plot ...\n      $(\"#waveform-viewer\").waveformplot(\"option\", \"selection\", selected_waveform_indexes[parseInt(cluster_index, 10)]);\n      $(\"#waveform-viewer\").waveformplot(\"option\", \"highlight\", selected_simulations);\n\n      // Update bookmark\n      var state = {};\n      state[ cluster_index + \"-selected-nodes\" ] = selected_nodes[cluster_index];\n      state[ cluster_index + \"-selected-waveform-indexes\" ] = selected_waveform_indexes[parseInt(cluster_index, 10)];\n      bookmarker.updateState(state);    \n    }\n\n    // Changing the selected dendrogram node updates the table ...\n    $(\"#table\").table(\"option\", \"row-selection-silent\", selected_simulations);\n    $(\"#table\").table(\"option\", \"selection\", parameters.selection);\n\n    // Post analytics\n    if(parameters.node != null && parameters.node[\"node-index\"] != null)\n    {\n      $.ajax(\n      {\n        type : \"POST\",\n        url : api_root + \"events/models/\" + model._id + \"/select/node/\" + parameters.node[\"node-index\"],\n      });\n    }\n  }\n\n  function selected_simulations_changed(selection)\n  {\n    selected_simulations = selection;\n    // Logging every selected item is too slow, so just log the count instead.\n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"events/models/\" + model._id + \"/select/simulation/count/\" + selected_simulations.length\n    });\n    var bookmark_selected_simulations = {};\n    bookmark_selected_simulations[\"simulation-selection\"] = selected_simulations;\n    bookmarker.updateState(bookmark_selected_simulations);\n  }\n\n  function selected_variable_changed(variable)\n  {\n    selected_column[cluster_index] = variable;\n    selected_column_type[cluster_index] = table_metadata[\"column-types\"][selected_column[cluster_index]];\n    selected_column_min[cluster_index] = table_metadata[\"column-min\"][selected_column[cluster_index]];\n    selected_column_max[cluster_index] = table_metadata[\"column-max\"][selected_column[cluster_index]];\n    \n    update_waveform_dendrogram_table_legend_on_selected_variable_changed();\n\n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"events/models/\" + model._id + \"/select/variable/\" + selected_column[cluster_index]\n    });\n    var selected_variable = {};\n    selected_variable[cluster_index + \"-column-index\"] = selected_column[cluster_index];\n    bookmarker.updateState(selected_variable);\n  }\n\n  function update_current_colorscale(callback)\n  {\n    if(selected_column_type[cluster_index] != \"string\")\n    {\n      colorscale = $(\"#color-switcher\").colorswitcher(\"get_color_scale\", undefined, selected_column_min[cluster_index], selected_column_max[cluster_index]);\n      callback(colorscale);\n    }\n    else\n    {\n      $.ajax({\n        type: \"GET\",\n        url : api_root + \"models/\" + model._id + \"/arraysets/inputs/metadata?unique=0/\" + selected_column[cluster_index] + \"/...\",\n        success : function(result) {\n          uniqueValues = result.unique[0].values[0];\n          colorscale = $(\"#color-switcher\").colorswitcher(\"get_color_scale_ordinal\", undefined, uniqueValues);\n          callback(colorscale);\n        },\n        error: function(result) {\n          console.log(\"there was an error. here it is: \" + result);\n        }\n      });\n    }\n  }\n\n  function update_waveform_dendrogram_table_legend_on_selected_variable_changed()\n  {\n    update_current_colorscale(function(colorscale){\n      retrieve_sorted_column({\n        column : selected_column[cluster_index],\n        callback : function(array){\n          var parameters = {\n            color_array : array,\n            color_scale : colorscale,\n          };\n\n          $(\"#waveform-viewer\").waveformplot(\"option\", \"color-options\", parameters);\n          $(\"#dendrogram-viewer\").dendrogram(\"option\", \"color-options\", parameters);\n          $(\"#table\").table(\"option\", \"colorscale\", colorscale);\n          $(\"#legend\").legend(\"option\", {\n            min: table_metadata[\"column-min\"][selected_column[cluster_index]],\n            max: table_metadata[\"column-max\"][selected_column[cluster_index]],\n            label: table_metadata[\"column-names\"][selected_column[cluster_index]],\n            v_type: selected_column_type[cluster_index],\n            uniqueValues: uniqueValues,\n          });\n        }\n      });\n    });\n  }\n\n  function variable_sort_changed(variable, order)\n  {\n    sort_variable = variable;\n    sort_order = order;\n    \n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"events/models/\" + model._id + \"/select/sort-order/\" + variable + \"/\" + order\n    });\n    bookmarker.updateState( {\"sort-variable\" : sort_variable, \"sort-order\" : sort_order} );\n  }\n\n  function expanded_collapsed_nodes_changed(nodes){\n    collapsed_nodes[cluster_index] = nodes.collapsed;\n    expanded_nodes[cluster_index] = nodes.expanded;\n\n    var cluster_state = {};\n    cluster_state[cluster_index + \"-expanded-nodes\"] = expanded_nodes[cluster_index];\n    cluster_state[cluster_index + \"-collapsed-nodes\"] = collapsed_nodes[cluster_index];\n    bookmarker.updateState(cluster_state);\n  }\n\n  function node_toggled(node){\n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"events/models/\" + model._id + \"/toggle/node/\" + node[\"node-index\"],\n    });\n  }\n\n  function update_dendrogram(cluster)\n  {\n    // Retrieve cluster data if it's not already in the cache\n    if((clusters_data[cluster] === undefined) || (clusters_data[cluster] === null)) {\n       $.ajax(\n      {\n        url : api_root + \"models/\" + model._id + \"/files/cluster-\" + s_to_a(clusters)[cluster],\n        contentType : \"application/json\",\n        success : function(cluster_data)\n        {\n          clusters_data[cluster] = cluster_data;\n          var dendrogram_options = build_dendrogram_node_options(cluster);\n          dendrogram_options.cluster_data = s_to_o(clusters_data[cluster]);\n          $(\"#dendrogram-viewer\").dendrogram(\"option\", dendrogram_options);\n        },\n        error: artifact_missing\n      });\n    } else {\n      var dendrogram_options = build_dendrogram_node_options(cluster);\n      dendrogram_options.cluster_data = s_to_o(clusters_data[cluster]);\n      $(\"#dendrogram-viewer\").dendrogram(\"option\", dendrogram_options);\n    }\n  }\n\n  function update_waveformplot(cluster)\n  {\n    // Retrieve waveform data if it's not already in the cache\n    if(waveforms_data[cluster] === undefined) {\n      // Load the waveforms.\n      chunker.get_model_arrayset({\n        api_root : api_root,\n        mid : model._id,\n        aid : \"preview-\" + s_to_a(clusters)[cluster],\n        success : function(result, metadata)\n        {\n          waveforms_data[cluster] = result;\n          waveforms_metadata[cluster] = metadata;\n          var waveformplot_options =\n          {\n            waveforms: waveforms_data[cluster],\n            selection: selected_waveform_indexes[cluster],\n            highlight: selected_simulations,\n          };\n          $(\"#waveform-viewer\").waveformplot(\"option\", \"waveforms\", waveformplot_options);\n        },\n        error : artifact_missing\n      });\n    } else {\n      var waveformplot_options =\n      {\n        waveforms: waveforms_data[cluster],\n        selection: selected_waveform_indexes[cluster],\n        highlight: selected_simulations,\n      };\n      $(\"#waveform-viewer\").waveformplot(\"option\", \"waveforms\", waveformplot_options);\n    }\n  }\n\n  function build_dendrogram_node_options(cluster)\n  {\n    var dendrogram_options = {\n      cluster: cluster,\n    };\n\n    dendrogram_options.collapsed_nodes = collapsed_nodes[cluster];\n    dendrogram_options.expanded_nodes = expanded_nodes[cluster];\n    dendrogram_options.selected_nodes = selected_nodes[cluster];\n    dendrogram_options.highlight = selected_simulations;\n\n    return dendrogram_options;\n  }\n\n  function getWaveformIndexes(nodes)\n  {\n    var waveform_indexes = [];\n    var waveform_index = null;\n\n    $.each(nodes, function(index, node)\n    {\n      waveform_index = node[\"waveform-index\"];\n      if(waveform_index != null)\n        waveform_indexes.push(waveform_index);\n    });\n\n    return waveform_indexes;\n  }\n\n  function getNodeIndexes(nodes)\n  {\n    var node_indexes = [];\n    var node_index = null;\n\n    for(var i=0; i<nodes.length; i++)\n    {\n      node_index = nodes[i][\"node-index\"];\n      if(node_index != null)\n        node_indexes.push(node_index);\n    }\n\n    return node_indexes;\n  }\n\n});","module.exports = { \"default\": require(\"core-js/library/fn/get-iterator\"), __esModule: true };","require('../modules/web.dom.iterable');\nrequire('../modules/es6.string.iterator');\nmodule.exports = require('../modules/core.get-iterator');\n","var anObject = require('./_an-object');\nvar get = require('./core.get-iterator-method');\nmodule.exports = require('./_core').getIterator = function (it) {\n  var iterFn = get(it);\n  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');\n  return anObject(iterFn.call(it));\n};\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94EHhESC1NkMY8AAABaSURBVDjLY2AYkiAtLRSrOCMBTf8JGTxr1mpGFiIcwDhr1mq4K2bNWo2hgIkIQ4RwaSbakFmzVr8jpIaJlIDF5RoWYgOQkiglynAmalg2eAyhSoqlSt4ZPAAAhK0aFjM865EAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB94EHhEOMAQYhfYAAABcSURBVDjL1ZM7DoBACERn1rXxCN7/mCbPxsKChJVoslIBgRm+0i8FWCK/kyQyYNvOmAH2SzewVsoH6Dc7ZG0D5R6j7ZdnIkn9SXB1pUPg7Q2yeUC+v9gAdJv7u0+kGjIYZ1Y9RwAAAABJRU5ErkJggg==\"","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\nexport var arrayset_metadata_cache = {};\nexport var arrayset_metadata_retrieval_inprogress = {};\nexport var arrayset_metadata_callbacks = {};\n\nexport function is_little_endian()\n{\n  if(window.result === undefined)\n    window.result = ((new Uint32Array((new Uint8Array([1,2,3,4])).buffer))[0] === 0x04030201);\n  return window.result;\n}\n\n// Retrieve an array attribute's metadata asynchronously, calling a callback when it's ready ...\nfunction get_model_array_attribute_metadata(parameters, dfd)\n{\n  return $.ajax({\n    url : parameters.api_root + \"models/\" + parameters.mid + \"/arraysets/\" + parameters.aid + \"/metadata?arrays=\" + parameters.array,\n    contentType : \"application/json\",\n    success: function(result)\n    {\n      parameters.metadata = result.arrays[0];\n      if(parameters.metadataSuccess !== undefined) {\n        parameters.metadataSuccess(parameters);\n      } else {\n        parameters.success(parameters);\n      }\n    },\n    error: function(request, status, reason_phrase)\n    {\n      if(parameters.error)\n        parameters.error(request, status, reason_phrase);\n    },\n    always: function() {\n      dfd.resolve();\n    }\n  });\n}\n\n// Retrieve an arrayset's metadata asynchronously, calling a callback when it's ready ...\nexport function get_model_arrayset_metadata(parameters)\n{\n  // It's cached, so just execute callback with cached metadata\n  if(arrayset_metadata_cache[parameters.api_root + parameters.mid + parameters.aid] !== undefined) {\n    parameters.metadata = arrayset_metadata_cache[parameters.api_root + parameters.mid + parameters.aid];\n    if(parameters.metadataSuccess !== undefined) {\n      parameters.metadataSuccess(parameters);\n    } else {\n      parameters.success(parameters);\n    }\n  }\n  // It's being cached now, so add callback to queue\n  else if(arrayset_metadata_retrieval_inprogress[parameters.api_root + parameters.mid + parameters.aid]) {\n    var callback = parameters.metadataSuccess !== undefined ? parameters.metadataSuccess : parameters.success;\n    arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid].push({callback:callback, parameters: parameters});\n  } \n  // It's not in the cache and it's not being cached, so retrieve it and execute callback queue\n  else {\n    arrayset_metadata_retrieval_inprogress[parameters.api_root + parameters.mid + parameters.aid] = true;\n    var callback = parameters.metadataSuccess !== undefined ? parameters.metadataSuccess : parameters.success;\n    if(arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid] === undefined)\n    {\n      arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid] = [];\n    }\n    arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid].push({callback:callback, parameters: parameters});\n\n    $.ajax({\n      url : parameters.api_root + \"models/\" + parameters.mid + \"/arraysets/\" + parameters.aid + \"/metadata\",\n      contentType : \"application/json\",\n      success: function(metadata)\n      {\n        arrayset_metadata_cache[parameters.api_root + parameters.mid + parameters.aid] = metadata;\n        arrayset_metadata_retrieval_inprogress[parameters.api_root + parameters.mid + parameters.aid] = false;\n        // Execute callback queue\n        for(var i=0; i < arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid].length; i++)\n        {\n          var callback_parameters = arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid][i].parameters;\n          callback_parameters.metadata = metadata;\n          arrayset_metadata_callbacks[parameters.api_root + parameters.mid + parameters.aid][i].callback(callback_parameters);\n        }\n      },\n      error: function(request, status, reason_phrase)\n      {\n        if(parameters.error)\n          parameters.error(request, status, reason_phrase);\n      }\n    });\n  }\n}\n\n// Cast a generic arraybuffer to a typed array, with an optional offset and\n// count.  Note that offset and count are measured in elements, not bytes.\nexport function cast_array_buffer(buffer, type, offset, count)\n{\n  if(type == \"int32\")\n  {\n    if(offset !== undefined)\n      return new Int32Array(buffer, offset*4, count);\n    else\n      return new Int32Array(buffer);\n  }\n  else if(type == \"int16\")\n  {\n    if(offset !== undefined)\n      return new Int16Array(buffer, offset*2, count);\n    else\n      return new Int16Array(buffer);\n  }\n  else if(type == \"int8\")\n  {\n    if(offset !== undefined)\n      return new Int8Array(buffer, offset, count);\n    else\n      return new Int8Array(buffer);\n  }\n  else if(type == \"uint32\")\n  {\n    if(offset !== undefined)\n      return new Uint32Array(buffer, offset*4, count);\n    else\n      return new Uint32Array(buffer);\n  }\n  else if(type == \"uint16\")\n  {\n    if(offset !== undefined)\n      return new Uint16Array(buffer, offset*2, count);\n    else\n      return new Uint16Array(buffer);\n  }\n  else if(type == \"uint8\")\n  {\n    if(offset !== undefined)\n      return new Uint8Array(buffer, offset, count);\n    else\n      return new Uint8Array(buffer);\n  }\n  else if(type == \"float64\")\n  {\n    if(offset !== undefined)\n      return new Float64Array(buffer, offset*8, count);\n    else\n      return new Float64Array(buffer);\n  }\n  else if(type == \"float32\")\n  {\n    if(offset !== undefined)\n      return new Float32Array(buffer, offset*4, count);\n    else\n      return new Float32Array(buffer);\n  }\n  else\n    console.error(\"Unknown array buffer type: \" + type);\n}\n\n// Retrieve an array attribute asynchronously, calling a callback when it's ready ...\nexport function get_model_array_attribute(parameters) {\n  var dfd = $.Deferred();\n  if(parameters.metadata === undefined) {\n    parameters.metadataSuccess = retrieve_model_array_attribute;\n    get_model_array_attribute_metadata(parameters, dfd);\n  }\n  else {\n    retrieve_model_array_attribute(parameters);\n  }\n  return dfd;\n\n  function retrieve_model_array_attribute(parameters) {\n    var ranges = [];\n    var range = '';\n    var metadata = parameters.metadata;\n    var attribute = parameters.attribute;\n    var isStringAttribute = metadata.attributes[attribute].type == \"string\";\n    var byteorder = \"&byteorder=\" + (is_little_endian() ? \"little\" : \"big\");\n    if(isStringAttribute)\n    {\n      byteorder = \"\";\n    }\n\n    for(var dimension in metadata.dimensions)\n    {\n      range = '';\n      range += metadata.dimensions[dimension].begin;\n      range += ':';\n      range += metadata.dimensions[dimension].end;\n      ranges.push(range);\n    }\n    ranges = ranges.join(\"|\");\n\n    var request = new XMLHttpRequest();\n    request.open(\"GET\", parameters.api_root + \"models/\" + parameters.mid + \"/arraysets/\" + parameters.aid + \"/data?hyperchunks=\" + parameters.array + \"/\" + parameters.attribute + \"/\" + ranges + byteorder);\n    if(!isStringAttribute)\n    {\n      request.responseType = \"arraybuffer\";\n    }\n    request.success = parameters.success;\n    request.attribute = parameters.attribute;\n    request.metadata = metadata;\n    request.isStringAttribute = isStringAttribute;\n    request.onload = function(e)\n    {\n      var buffer = this.response;\n      var metadata = this.metadata;\n      var attribute = this.metadata.attributes[this.attribute];\n      var result;\n\n      if(metadata.dimensions.length == 1)\n      {\n        if(!this.isStringAttribute)\n        {\n          result = cast_array_buffer(buffer, attribute.type);\n        }\n        else\n        {\n          result = JSON.parse(this.responseText);\n        }\n      }\n      else if(metadata.dimensions.length == 2)\n      {\n        var row_count = metadata.dimensions[0].end - metadata.dimensions[0].begin;\n        var column_count = metadata.dimensions[1].end - metadata.dimensions[1].begin;\n        var result = [];\n        for(var i = 0; i != row_count; ++i)\n        {\n          result.push(cast_array_buffer(buffer, attribute.type, i * column_count, column_count));\n        }\n      }\n      else\n      {\n        window.alert(\"Can't handle array with \" + metadata.dimensions.length + \" dimensions.\");\n      }\n      this.success(result);\n      dfd.resolve();\n    }\n    request.send();\n  }\n}\n\n// Retrieve an arrayset asynchronously, calling a callback when it's ready ...\nexport function get_model_arrayset(parameters)\n{\n  if(parameters.metadata !== undefined) \n  {\n    retrieve_model_arrayset(parameters);\n  } \n  else if (arrayset_metadata_cache[parameters.api_root + parameters.mid + parameters.aid] !== undefined) \n  {\n    parameters.metadata = arrayset_metadata_cache[parameters.api_root + parameters.mid + parameters.aid];\n    retrieve_model_arrayset(parameters);\n  } \n  else \n  {\n    parameters.metadataSuccess = retrieve_model_arrayset;\n    get_model_arrayset_metadata(parameters);\n  }\n\n  function retrieve_model_arrayset(parameters)\n  {\n    var metadata = parameters.metadata;\n\n    var arrays = [];\n    var hyperchunks = [];\n\n    if(\"arrays\" in parameters)\n    {\n      for(var i = parseInt(parameters.arrays.split(\":\")[0]); i != parseInt(parameters.arrays.split(\":\")[1]); ++i)\n      {\n        arrays.push(i);\n      }\n      for(var i = 0; i != arrays.length; ++i)\n      {\n        var array = arrays[i];\n        for(var attribute = 0; attribute != metadata[array].attributes.length; ++attribute)\n        {\n          hyperchunks.push(array + \"/\" + attribute + \"/...\");\n        }\n      }\n    }\n    else\n    {\n      hyperchunks.push(\".../.../...\");\n    }\n\n    var uri = parameters.api_root + \"models/\" + parameters.mid + \"/arraysets/\" + parameters.aid + \"/data?byteorder=\" + (is_little_endian() ? \"little\" : \"big\") + \"&hyperchunks=\" + encodeURIComponent(hyperchunks.join(\";\"));\n    var request = new XMLHttpRequest();\n    request.open(\"GET\", uri);\n    request.responseType = \"arraybuffer\";\n    request.success = parameters.success;\n    request.metadata = metadata;\n    request.onload = function(e)\n    {\n      var buffer = this.response;\n      var metadata = this.metadata;\n      var results = [];\n      var result, item, index, count, attributes, attribute = null;\n      var start = 0;\n      var length = metadata.length;\n      if(parameters.arrays !== undefined) {\n        var arrays = parameters.arrays.split(\":\");\n        start = parseInt(arrays[0]);\n        length = parseInt(arrays[1]);\n      }\n      var offset = 0;\n      for(var i=start; i < length; i++)\n      {\n        item = metadata[i];\n        index = item.index;\n        count = item.dimensions[0].end - item.dimensions[0].begin;\n        attributes = item.attributes;\n        result = {};\n        result[\"input-index\"] = index;\n        for(var j=0; j < attributes.length; j++)\n        {\n          attribute = attributes[j];\n          result[attribute.name] = cast_array_buffer(buffer, attribute.type, offset, count);\n          offset = offset + count;\n        }\n        results.push(result);\n      }\n      this.success(results, metadata, parameters);\n    }\n    request.send();\n  }\n}\n","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract\n DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government\n retains certain rights in this software. */\n\nimport client from \"js/slycat-web-client\";\nimport * as dialog from \"js/slycat-dialog\";\nimport ko from \"knockout\";\nimport mapping from \"knockout-mapping\";\nimport URI from \"urijs\";\nimport slycatJobChecker from \"templates/slycat-job-checker.html\";\n\nko.components.register('slycat-job-checker', {\n  viewModel: function(params) {\n    var model = { _id: URI(window.location).segment(-1) };\n    var vm = this;\n    vm.remote = mapping.fromJS({ hostname: null, username: null, password: null, status: null, status_type: null, enable: true, focus: false, sid: null, session_exists: false });\n    vm.remote.focus.extend({ notify: 'always'  });\n    vm.jid = ko.observable(-1);\n    vm.output = ko.observable('Output for the current job will be posted here...');\n    var iid = -1; // window.setInterval() ID\n    var previous_state = '';\n\n    vm.connect = function() {\n      vm.remote.enable(false);\n      vm.remote.status_type('info');\n      vm.remote.status('Connecting...');\n      if(vm.remote.session_exists())\n      {\n        vm.remote.enable(true);\n        vm.remote.status_type(null);\n        vm.remote.status(null);\n        $('#slycat-job-checker-connect-modal').modal('hide');\n        $('#slycat-job-checker-cancel').removeAttr('disabled');\n        vm.checkjob();\n      }\n      else{\n          client.post_remotes({\n            hostname: vm.remote.hostname(),\n            username: vm.remote.username(),\n            password: vm.remote.password(),\n            success: function(sid) {\n              vm.remote.session_exists(true);\n              vm.remote.sid(sid);\n              vm.remote.enable(true);\n              vm.remote.status_type(null);\n              vm.remote.status(null);\n              $('#slycat-job-checker-connect-modal').modal('hide');\n              $('#slycat-job-checker-cancel').removeAttr('disabled');\n              vm.checkjob();\n            },\n            error: function(request, status, reason_phrase) {\n              $('#slycat-job-checker-cancel').attr('disabled');\n              vm.remote.enable(true);\n              vm.remote.status_type('danger');\n              vm.remote.status(reason_phrase);\n              vm.remote.focus('password');\n            }\n          });\n      }\n    };\n\n    vm.cancel = function() {\n      vm.remote.password('');\n      $('#slycat-job-checker-connect-modal').modal('hide');\n      vm.output(vm.output() + '\\n' + 'Please reload the page to check job ' + vm.jid() + '\\'s status.');\n    };\n\n    vm.cancel_pull = function() {\n      vm.remote.password('');\n      console.log(\"cancel\");\n      $('#slycat-pull-job-connect-modal').modal('hide');\n      vm.output(vm.output() + '\\n' + 'Please reload the page to check job ' + vm.jid() + '\\'s status.');\n    };\n    var get_job_output = function() {\n      vm.output(vm.output() + '\\n\\n' + 'Please reload to view model.');\n      window.location.reload(true);\n    };\n\n    var repeated_state = function(state) {\n      return previous_state === state ? true : false;\n    };\n\n    var routine = function(jid) {\n  client.get_checkjob({\n        hostname: vm.remote.hostname(),\n        jid: vm.jid(),\n        success: function(results) {\n          if (results.errors) {\n            vm.output(vm.output() + '\\n' + '[Error] Could not check job iD=' + vm.jid() + ' status: ' + results.errors);\n            return void 0;\n          }\n\n          var s = results.status.state;\n\n          if (!repeated_state(s))\n            vm.output(vm.output() + '\\n' + 'Job ID=' + vm.jid() + ' is ' + s);\n          else\n            vm.output(vm.output() + '.');\n\n          if (s === 'COMPLETED' || s === 'FAILED') {\n            clearInterval(iid);\n            get_job_output();\n            previous_state = '';\n          }\n\n          if (s === 'CANCELLED' || s === 'REMOVED') {\n            clearInterval(iid);\n            previous_state = '';\n          }\n\n          previous_state = s;\n        },\n        error: function(request, status, reason_phrase) {\n          vm.output(vm.output() + '\\n' + '[Error] Could not check job status: ' + status + ' :' + reason_phrase);\n        }\n      });\n    };\n\n    vm.pullDataFromHpc = function() {\n      console.log(\"1\");\n      vm.remote.enable(false);\n      vm.remote.status_type('info');\n      vm.remote.status('Connecting...');\n      if(vm.remote.session_exists())\n      {\n        console.log(\"got session\");\n        vm.remote.enable(true);\n        vm.remote.status_type(null);\n        vm.remote.status(null);\n        $('#slycat-pull-job-connect-modal').modal('hide');\n        vm.pullHPCData();\n      }\n      else{\n          client.post_remotes({\n            hostname: vm.remote.hostname(),\n            username: vm.remote.username(),\n            password: vm.remote.password(),\n            success: function(sid) {\n              vm.remote.session_exists(true);\n              vm.remote.sid(sid);\n              vm.remote.enable(true);\n              vm.remote.status_type(null);\n              vm.remote.status(null);\n              $('#slycat-pull-job-connect-modal').modal('hide');\n              vm.checkjob();\n            },\n            error: function(request, status, reason_phrase) {\n              $('#slycat-job-checker-cancel').attr('disabled');\n              vm.remote.enable(true);\n              vm.remote.status_type('danger');\n              vm.remote.status(reason_phrase);\n              vm.remote.focus('password');\n            }\n          });\n      }\n    };\n    vm.pullHPCData = function() {\n      console.log(\"2\");\n  client.get_model_command({\n        mid: model._id,\n        type: \"timeseries\",\n        command: \"pull_data\",\n        success: function(results) {\n          vm.output(vm.output() + '\\n' + 'started pull status :' + results.errors);\n        },\n        error: function(request, status, reason_phrase) {\n          vm.output(vm.output() + '\\n' + 'pull status: ' + status + ' :' + reason_phrase);\n        }\n      });\n    };\n\n    vm.checkjob = function() {\n      previous_state = '';\n      iid = setInterval(routine, 1000);\n    };\n\n    vm.set_jid = function(jid) {\n      vm.jid(jid);\n    };\n\n    $('#slycat-job-checker-connect').on('click', function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      $('#slycat-job-checker-connect-modal').modal();\n    });\n\n    $('#slycat-job-pull').on('click', function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      $('#slycat-pull-job-connect-modal').modal();\n    });\n\n  $('#slycat-job-checker-clear').on('click', function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      vm.output('');\n    });\n\n    $('#slycat-job-checker-cancel').on('click', function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      client.delete_job({\n        hostname: vm.remote.hostname(),\n        jid: vm.jid()\n      });\n    });\n  },\n  template: slycatJobChecker\n})","module.exports = \"<div class=\\\"slycat-job-checker bootstrap-styles\\\">\\n  <div class=\\\"slycat-job-checker-controls\\\">\\n    <button id=\\\"slycat-job-checker-connect\\\" class=\\\"btn btn-default\\\">Connect To View Job Output</button>\\n    <button id=\\\"slycat-job-checker-clear\\\" class=\\\"btn btn-default\\\">Clear Output</button>\\n    <button id=\\\"slycat-job-pull\\\" class=\\\"btn btn-default\\\">Pull data</button>\\n    <button id=\\\"slycat-job-checker-cancel\\\" class=\\\"btn btn-danger\\\" disabled>Cancel Job</button>\\n  </div>\\n  <div class=\\\"slycat-job-checker-output\\\" data-bind=\\\"text: output\\\"></div>\\n\\n  <div id=\\\"slycat-job-checker-connect-modal\\\" class=\\\"modal fade\\\" data-backdrop=\\\"static\\\">\\n    <div class=\\\"modal-dialog\\\">\\n      <div class=\\\"modal-content zoom-sensitive\\\">\\n        <div class=\\\"modal-header\\\">\\n          <h4 class=\\\"modal-title\\\">Connect to host...</h4>\\n        </div>\\n        <div class=\\\"modal-body\\\">\\n          <form class=\\\"form-horizontal\\\" role=\\\"form\\\">\\n            <slycat-remote-controls params=\\\"hostname:remote.hostname,username:remote.username,password:remote.password,status:remote.status,status_type:remote.status_type,enable:remote.enable,focus:remote.focus,activate:connect,session_exists:remote.session_exists\\\"></slycat-remote-controls>\\n          </form>\\n        </div>\\n        <div class=\\\"modal-footer\\\">\\n          <button class=\\\"btn btn-primary\\\" data-bind=\\\"click:connect,enable:remote.enable\\\">Connect</button>\\n          <button class=\\\"btn btn-default pull-left\\\" data-bind=\\\"click:cancel\\\">Cancel</button>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n\\n  <div id=\\\"slycat-pull-job-connect-modal\\\" class=\\\"modal fade\\\" data-backdrop=\\\"static\\\">\\n    <div class=\\\"modal-dialog\\\">\\n      <div class=\\\"modal-content zoom-sensitive\\\">\\n        <div class=\\\"modal-header\\\">\\n          <h4 class=\\\"modal-title\\\">Connect to host...</h4>\\n        </div>\\n        <div class=\\\"modal-body\\\">\\n          <form class=\\\"form-horizontal\\\" role=\\\"form\\\">\\n            <slycat-remote-controls params=\\\"hostname:remote.hostname,username:remote.username,password:remote.password,status:remote.status,status_type:remote.status_type,enable:remote.enable,focus:remote.focus,activate:connect,session_exists:remote.session_exists\\\"></slycat-remote-controls>\\n          </form>\\n        </div>\\n        <div class=\\\"modal-footer\\\">\\n          <button class=\\\"btn btn-primary\\\" data-bind=\\\"click:pullDataFromHpc,enable:remote.enable\\\">Connect</button>\\n          <button class=\\\"btn btn-default pull-left\\\" data-bind=\\\"click:cancel_pull\\\">Cancel</button>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</div>\\n\\n\";","\nvar content = require(\"!!../../../../node_modules/css-loader/index.js!./ui.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../node_modules/css-loader/index.js!./ui.css\", function() {\n\t\tvar newContent = require(\"!!../../../../node_modules/css-loader/index.js!./ui.css\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\\n\\n.ui-layout-resizer\\n{\\n  background-color: #ddc;\\n}\\n.ui-layout-toggler\\n{\\n  background-color: #ccb;\\n}\\n.ui-layout-resizer-open.ui-layout-resizer-hover, .ui-layout-resizer-dragging, .ui-layout-toggler-hover\\n{\\n  background-color: #fc6;\\n}\\n.ui-layout-pane, .ui-layout-container\\n{\\n  background: white;\\n  padding: 0;\\n  border: 0;\\n  margin: 0;\\n}\\n\\n#edit-model-button,\\n#rerun-timeseries-button\\n{\\n  float: right;\\n}\\n\\n/* cluster table styles */\\n\\n#cluster-pane\\n{\\n  z-index: 3 !important; /* Required to make bootstrap dropdowns appear over lower panes */\\n}\\n#controls {\\n  margin: 2px 0px;\\n}\\n.center {\\n  text-align: center;\\n}\\n\\n#cluster-viewer\\n{\\n  margin: 5px;\\n  border-collapse: collapse;\\n}\\n#cluster-viewer td,\\n#cluster-viewer th\\n{\\n  padding: 3px;\\n}\\n#cluster-viewer td.output\\n{\\n  background: #dbd9eb;\\n  cursor: pointer;\\n}\\n#cluster-viewer td.output.selected\\n{\\n  background: #7767b0;\\n  color: white;\\n}\\n\\n/* dendrogram styles */\\n#dendrogram-pane #dendrogram-sort-control \\n{\\n  position: absolute;\\n  bottom: 0px;\\n  left: 0px;\\n  cursor: pointer;\\n  background: #DBD9EB url(\" + escape(require(\"../../../img/sort-dendrogram.png\")) + \") no-repeat center center;\\n  padding: 4px;\\n  margin: 0 0 5px 18px;\\n  height: 17px;\\n  min-width: 17px;\\n}\\n\\n#dendrogram-pane #dendrogram-sort-control.selected\\n{\\n  background: #7767B0 url(\" + escape(require(\"../../../img/sort-dendrogram-selected.png\")) + \") no-repeat center center;\\n  color: #FFFFFF;\\n  cursor: default;\\n}\\n\\n#dendrogram-pane #dendrogram-controls \\n{\\n  position: absolute;\\n  top: 0px;\\n  left: 0px;\\n  margin: 5px 0 0px 18px;\\n}\\n\\n#dendrogram-viewer .node .glyph circle\\n{\\n  stroke: grey;\\n}\\n\\n#dendrogram-viewer .node.selected .glyph circle\\n{\\n  fill: #7767b0 !important;\\n  stroke: black;\\n}\\n\\n#dendrogram-viewer .node .glyph text\\n{\\n  cursor: pointer;\\n}\\n\\n#dendrogram-viewer .node .subtree\\n{\\n  cursor: pointer;\\n}\\n\\na \\n{\\n  cursor: pointer;\\n}\\n\\n#dendrogram-viewer .node .subtree path\\n{\\n  stroke: none;\\n}\\n\\n/* Hiding the additional glyph initially */\\n#dendrogram-viewer .node .subtree path.filled-glyph\\n{\\n  display: none;\\n}\\n/* Showing it for selected nodes */\\n#dendrogram-viewer .node.selected .subtree path.filled-glyph\\n{\\n  display: inline;\\n}\\n\\n#dendrogram-viewer .node.selected .subtree text\\n{\\n  fill: white;\\n}\\n\\n#dendrogram-viewer .node .sparkline path\\n{\\n  fill: none;\\n  stroke: black;\\n}\\n\\n#dendrogram-viewer .link\\n{\\n  fill: none;\\n  stroke: #C9C9C9;\\n}\\n\\n/* waveform styles */\\n\\n#waveform\\n{\\n  width: 1000px;\\n  height: 700px;\\n}\\n\\n/* data table styles */\\n\\n#data-pane\\n{\\n  overflow: auto;\\n}\\n\\n/* Waveform Progress Indicator */\\n#waveform-progress,\\n#waveform-selection-progress\\n{\\n    background-color: transparent;\\n    position: absolute;\\n    left: 50%;\\n    top: 50%;\\n    width: 200px;\\n    height: 200px;\\n    margin: -100px 0 0 -100px;\\n    display: none;\\n}\\n#waveform-selection-progress\\n{\\n  z-index: 1;\\n}\\n#waveform-selector-progress {\\n  background-color: transparent;\\n  position: absolute;\\n  left: 0px;\\n  top: 3px;\\n  width: 100%;\\n  height: 15px;\\n  text-align: center;\\n  display: none;\\n}\\n#waveform-selector-progress-wrapper {\\n  display: none;\\n}\\n#waveform-pane:hover #waveform-selector-progress-wrapper {\\n  display: block;\\n}\\n/* Use these colors for the dark night mode */\\n#waveform-viewer.nightMode,\\n.nightMode rect.selectionMask\\n{\\n  background-color: #333333;\\n  fill: #333333;\\n  fill-opacity: 0.5;\\n}\\n/* Use these colors for the white day mode */\\n#waveform-viewer.dayMode,\\n.dayMode rect.selectionMask\\n{\\n  background-color: white;\\n  fill: white;\\n  fill-opacity: 0.7;\\n}\\n\\n#waveform-viewer .waveform path.unselected {\\n  stroke-width: 1;\\n  fill: none;\\n  stroke-linecap: round;\\n}\\n#waveform-viewer .waveform path.unselected:hover {\\n  stroke-width: 4;\\n}\\n#waveform-viewer .selection path.highlight {\\n  stroke-width: 4.0;\\n  fill: none;\\n  stroke-linecap: round;\\n}\\n#table\\n{\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n}\\n#dendrogram-sparkline-backdrop {\\n  height: 100%;\\n  width: 130px;\\n  position: absolute;\\n  right: 0;\\n  z-index: -1;\\n}\\n#dendrogram-viewer g.sparkline path {\\n  stroke-linecap: round;\\n}\\n#dendrogram-viewer g.sparkline path:hover,\\n#dendrogram-viewer g.sparkline path.highlight\\n{\\n  stroke-width: 4px;\\n}\\n#dendrogram-viewer g.sparkline path.highlight {\\n  \\n}\\n#dendrogram-viewer g.sparkline path.nullValue {\\n  stroke-dasharray: 2px, 2px;\\n}\\n#dendrogram-viewer g.sparkline path.highlight.nullValue {\\n  stroke-dasharray: 2px, 5px;\\n}\\n.legend-axis path,\\n.legend-axis line,\\n.x-axis path, \\n.y-axis path\\n{\\n  fill: none;\\n  stroke: black;\\n  shape-rendering: crispedges;\\n}\\n\\n#color-switcher ul.dropdown-menu\\n{\\n  background-color: #F2F2F2;\\n}\\n.bootstrap-styles #color-switcher .dropdown-menu > li > a:hover\\n{\\n  background-color: #E4E4E4;\\n}\\n.bootstrap-styles #color-switcher .dropdown-menu > .active > a:hover\\n{\\n  background-color: #337AB7;\\n}\\n#controls  ul.dropdown-menu  {\\n  max-height: 300px;\\n  overflow-y: auto;\\n}\\n\", \"\"]);\n\n// exports\n","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\n///////////////////////////////////////////////////////////////////////////////////////////\n// HTML5 DOM cluster control, for use with the timeseries model.\n\nimport \"jquery-ui\";\n\n$.widget(\"timeseries.cluster\",\n{\n  options:\n  {\n  \tclusters:[],\n  \tcluster: 0,\n  },\n\n  _create: function()\n  {\n  \tvar self = this;\n\n  \tthis.select_cluster = function(cluster)\n    {\n      this.element.find(\"td.selected\").removeClass(\"selected\");\n      this.element.find(\"td:eq(\" + cluster + \")\").addClass(\"selected\");\n    }\n\n    function click_cluster(context, cluster)\n    {\n      return function()\n      {\n        context.select_cluster(cluster);\n        self.options.cluster = cluster;\n        context.element.trigger(\"cluster-changed\", cluster);\n      }\n    }\n\n  \tvar clusters = this.options.clusters;\n    var cluster = this.options.cluster;\n\n    var row = $(\"<tr>\").appendTo($(\"<thead>\").appendTo(this.element));\n    $(\"<th>\").text(\"Outputs:\").appendTo(row);\n    $.each(clusters, function(index, name)\n    {\n      $(\"<td>\")\n        .addClass(\"output\")\n        .appendTo(row)\n        .data(\"name\", name)\n        .data(\"self\", self)\n        .data(\"index\", index)\n        .text(name)\n        .click(click_cluster(self, index))\n        ;\n    });\n\n    // Setup the default selected cluster ...\n    this.select_cluster(this.options.cluster);\n  },\n\n});","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\nimport api_root from \"js/slycat-api-root\";\nimport * as dialog from \"js/slycat-dialog\";\nimport _ from \"lodash\";\nimport Papa from \"papaparse\";\nimport \"jquery-ui\";\nimport \"bootstrap\";\n\n$.widget(\"timeseries.controls\",\n{\n  options:\n  {\n    mid : null,\n    model_name : null,\n    aid : null,\n    metadata : null,\n    // cluster_index : null,\n    \"color-variable\" : null,\n    clusters : [],\n    cluster : null,\n    color_variables : [],\n    selection : [],\n    hidden_simulations : [],\n    indices : [],\n    highlight: [],\n  },\n\n  _create: function()\n  {\n    var self = this;\n    var general_controls = $(\"#general-controls\", this.element);\n\n    this.color_control = $('<div class=\"btn-group btn-group-xs\"></div>')\n      .appendTo(general_controls)\n      ;\n    this.color_button = $('\\\n      <button class=\"btn btn-default dropdown-toggle\" type=\"button\" id=\"color-dropdown\" data-toggle=\"dropdown\" aria-expanded=\"true\" title=\"Change Line Color\"> \\\n        Line Color \\\n        <span class=\"caret\"></span> \\\n      </button> \\\n      ')\n      .appendTo(self.color_control)\n      ;\n    this.color_items = $('<ul id=\"y-axis-switcher\" class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"color-dropdown\">')\n      .appendTo(self.color_control)\n      ;\n\n    this.csv_button = $(\"\\\n      <button class='btn btn-default' title='Download Data Table'> \\\n        <span class='fa fa-download' aria-hidden='true'></span> \\\n      </button> \\\n      \")\n      .click(function(){\n        if (self.options.highlight.length == 0 && ( self.options.selection == null || self.options.selection.length == self.options.metadata['row-count'] )) {\n          self._write_data_table();\n        } else {\n          openCSVSaveChoiceDialog();\n        }\n      })\n      .appendTo(general_controls)\n      ;\n\n    function openCSVSaveChoiceDialog(){\n      var txt = \"\";\n      var buttons_save = [\n        {className: \"btn-default\", label:\"Cancel\"}, \n        {className: \"btn-primary\", label:\"Save Entire Table\", icon_class:\"fa fa-table\"}\n      ];\n      var filteredHighlight;\n      if(self.options.selection != null && self.options.selection.length > 0)\n      {\n        filteredHighlight = self.options.highlight.filter(function(el){\n          return self.options.selection.indexOf(el) != -1;\n        });\n      }\n      else\n      {\n        filteredHighlight = self.options.highlight;\n      }\n\n      if(filteredHighlight.length > 0)\n      {\n        // txt += \"You have \" + filteredHighlight.length + \" rows selected. \";\n        txt += `You have ${filteredHighlight.length} rows selected. `;\n        buttons_save.splice(buttons_save.length-1, 0, {className: \"btn-primary\", label:\"Save Selected\", icon_class:\"fa fa-check\"});\n      }\n      if(self.options.selection != null && self.options.selection.length > 0 && self.options.selection.length < self.options.metadata['row-count'])\n      {\n        var visibleRows = self.options.selection.length;\n        txt += `You have ${visibleRows} rows visible. `;\n        buttons_save.splice(buttons_save.length-1, 0, {className: \"btn-primary\", label:\"Save Visible\", icon_class:\"fa fa-eye\"});\n      }\n\n      txt += \"What would you like to do?\";\n\n      dialog.dialog(\n      {\n        title: \"Download Choices\",\n        message: txt,\n        buttons: buttons_save,\n        callback: function(button)\n        {\n          if(button.label == \"Save Entire Table\")\n            self._write_data_table();\n          else if(button.label == \"Save Selected\")\n            self._write_data_table(filteredHighlight);\n          else if(button.label == \"Save Visible\")\n            self._write_data_table(self.options.selection);\n        },\n      });\n    }\n\n    // if(self.options.clusters.length > 0)\n    // {\n    //   self._set_clusters();\n    // }\n    self._set_color_variables();\n  },\n\n\n  _write_data_table: function(selectionList)\n  {\n    var self = this;\n    $.ajax(\n    {\n      type : \"POST\",\n      url : api_root + \"models/\" + self.options.mid + \"/arraysets/\" + self.options.aid + \"/data\",\n      data: JSON.stringify({\"hyperchunks\": \"0/.../...\"}),\n      contentType: \"application/json\",\n      success : function(result)\n      {\n        self._write_csv( self._convert_to_csv(result, selectionList), self.options.model_name + \"_data_table.csv\" );\n      },\n      error: function(request, status, reason_phrase)\n      {\n        window.alert(\"Error retrieving data table: \" + reason_phrase);\n      }\n    });\n  },\n\n  _write_csv: function(csvData, defaultFilename)\n  {\n    var blob = new Blob([ csvData ], {\n      type : \"application/csv;charset=utf-8;\"\n    });\n    var csvUrl = URL.createObjectURL(blob);\n    var link = document.createElement(\"a\");\n    link.href = csvUrl;\n    link.style = \"visibility:hidden\";\n    link.download = defaultFilename || \"slycatDataTable.csv\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  },\n\n  _convert_to_csv: function(array, sl)\n  {\n    // Note that array.data is column-major:  array.data[0][*] is the first column\n    var self = this;\n    \n    // Converting data array from column major to row major\n    var rowMajorData = _.zip(...array);\n\n    // If we have a selection list, remove everything but those elements from the data array\n    if(sl != undefined && sl.length > 0)\n    {\n      // sl is in the order the user selected the rows, so sort it.\n      // We want to end up with rows in the same order as in the original data.\n      sl.sort();\n      // Only keep elements at the indexes specified in sl\n      rowMajorData = _.at(rowMajorData, sl);\n    }\n\n    // Creating an array of column headers by removing the last one, which is the Index that does not exist in the data\n    var headers = self.options.metadata[\"column-names\"].slice(0, -1);\n    // Adding headers as first element in array of data rows\n    rowMajorData.unshift(headers);\n\n    // Creating CSV from data array\n    var csv = Papa.unparse(rowMajorData);\n    return csv;\n  },\n\n  _set_color_variables: function()\n  {\n    var self = this;\n    this.color_items.empty();\n    for(let value of this.options.color_variables) {\n      $(\"<li role='presentation'>\")\n        .toggleClass(\"active\", self.options[\"color-variable\"] == value)\n        .attr(\"data-colorvariable\", value)\n        .appendTo(self.color_items)\n        .append(\n          $('<a role=\"menuitem\" tabindex=\"-1\">')\n            .html(this.options.metadata['column-names'][value])\n            .click(function()\n            {\n              let menu_item = $(this).parent();\n              if(menu_item.hasClass(\"active\"))\n                return false;\n\n              self.color_items.find(\"li\").removeClass(\"active\");\n              menu_item.addClass(\"active\");\n\n              self.element.trigger(\"color-selection-changed\", menu_item.attr(\"data-colorvariable\"));\n            })\n        )\n        ;\n    }\n  },\n\n  _set_selected_color: function()\n  {\n    var self = this;\n    self.color_items.find(\"li\").removeClass(\"active\");\n    self.color_items.find('li[data-colorvariable=\"' + self.options[\"color-variable\"] + '\"]').addClass(\"active\");\n  },\n\n  // Clones an ArrayBuffer or Array\n  _cloneArrayBuffer: function(source)\n  {\n    // Array.apply method of turning an ArrayBuffer into a normal array is very fast (around 5ms for 250K) but doesn't work in WebKit with arrays longer than about 125K\n    // if(source.length > 1)\n    // {\n    //   return Array.apply( [], source );\n    // }\n    // else if(source.length == 1)\n    // {\n    //   return [source[0]];\n    // }\n    // return [];\n\n    // For loop method is much shower (around 300ms for 250K) but works in WebKit. Might be able to speed things up by using ArrayBuffer.subarray() method to make smallery arrays and then Array.apply those.\n    var clone = [];\n    for(var i = 0; i < source.length; i++)\n    {\n      clone.push(source[i]);\n    }\n    return clone;\n  },\n\n  _setOption: function(key, value)\n  {\n    var self = this;\n\n    this.options[key] = value;\n\n    if(key == \"color-variable\")\n    {\n      self._set_selected_color();\n    }\n    else if(key == 'color_variables')\n    {\n      self._set_color_variables();\n    }\n  },\n});","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\nimport d3 from \"js/d3.min\";\n\n$.widget(\"timeseries.legend\",\n{\n  options:\n  {\n    width: 300,\n    height: 300,\n    metadata : null,\n    label : \"Label\",\n    min : null,\n    max : null,\n    border : 25,\n    v_type : null,\n    uniqueValues : null,\n  },\n\n  _create: function()\n  {\n    var self = this;\n\n    // Setup the legend ...\n    self.svg = d3.select(self.element.get(0)).append(\"svg\");\n    self.legend_layer = self.svg.append(\"g\").attr(\"class\", \"legend\");\n    self.legend_axis_layer = self.legend_layer.append(\"g\").attr(\"class\", \"legend-axis\");\n    \n    self.updates = {};\n    self.update_timer = null;\n\n    self._schedule_update({\n      update_width:true,\n      update_height:true,\n      render_legend:true,\n      update_legend_colors:true,\n      update_legend_position:true,\n      update_legend_axis:true,\n      update_label:true,\n    });\n    \n  },\n\n  _setOption: function(key, value)\n  {\n    var self = this;\n\n    //console.log(\"timeseries.legend._setOption()\", key, value);\n    this.options[key] = value;\n\n    if(key == \"v\")\n    {\n      self._schedule_update({update_color_domain:true, render_data:true, render_selection:true, update_legend_axis:true});\n    }\n\n    else if(key == \"width\")\n    {\n      self._schedule_update({update_width:true, });\n    }\n\n    else if(key == \"height\")\n    {\n      self._schedule_update({update_height:true, update_legend_position:true, update_legend_axis:true, update_label:true,});\n    }\n\n    else if(key == \"gradient\")\n    {\n      self._schedule_update({update_legend_colors:true, });\n    }\n\n    else if(key == \"min\" || key == \"max\")\n    {\n      self._schedule_update({update_legend_axis:true, });\n    }\n\n    else if(key == \"label\")\n    {\n      self._schedule_update({update_label:true, })\n    }\n  },\n\n  _schedule_update: function(updates)\n  {\n    var self = this;\n\n    for(var key in updates)\n      self.updates[key] = updates[key];\n\n    if(self.update_timer)\n      return;\n\n    self.update_timer = window.setTimeout(function() { self._update(); }, 0);\n  },\n\n  _update: function()\n  {\n    var self = this;\n\n    //console.log(\"timeseries.legend._update()\", self.updates);\n    self.update_timer = null;\n\n    if(self.updates[\"update_width\"])\n    {\n      self.element.attr(\"width\", self.options.width);\n      self.svg.attr(\"width\", self.options.width);\n    }\n\n    if(self.updates[\"update_height\"])\n    {\n      self.element.attr(\"height\", self.options.height);\n      self.svg.attr(\"height\", self.options.height);\n    }\n\n    if(self.updates[\"render_legend\"])\n    {\n      var gradient = self.legend_layer.append(\"defs\").append(\"linearGradient\");\n      gradient.attr(\"id\", \"color-gradient\")\n        .attr(\"x1\", \"0%\").attr(\"y1\", \"0%\")\n        .attr(\"x2\", \"0%\").attr(\"y2\", \"100%\")\n        ;\n\n      var colorbar = self.legend_layer.append(\"rect\")\n        .classed(\"color\", true)\n        .attr(\"width\", 10)\n        .attr(\"height\", 200)\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .style(\"fill\", \"url(#color-gradient)\")\n        ;\n    }\n\n    if(self.updates[\"update_legend_colors\"])\n    {\n      var gradient = self.legend_layer.select(\"#color-gradient\");\n      var stop = gradient.selectAll(\"stop\").data(self.options.gradient);\n      stop.exit().remove();\n      stop.enter().append(\"stop\");\n      stop\n        .attr(\"offset\", function(d) { return d.offset + \"%\"; })\n        .attr(\"stop-color\", function(d) { return d.color; })\n        ;\n    }\n\n    if(self.updates[\"update_legend_position\"])\n    {\n      var total_width = self.element.width();\n      var total_height = self.element.height();\n      var rectHeight = parseInt(total_height - (self.options.border * 2));\n\n      var transx = self.options.border + 28; // 28 is height of label\n      var transy = self.options.border;\n       self.legend_layer\n        .attr(\"transform\", \"translate(\" + transx + \",\" + transy + \")\")\n        .attr(\"data-transx\", transx)\n        .attr(\"data-transy\", transy)\n        ;\n\n      self.legend_layer.select(\"rect.color\")\n        .attr(\"height\", rectHeight)\n        ;\n    }\n\n    if(self.updates[\"update_legend_axis\"])\n    {\n      if(self.options.v_type != 'string')\n      {\n        self.legend_scale = d3.scale.linear()\n          .domain([self.options.max, self.options.min])\n          .range([0, parseInt(self.legend_layer.select(\"rect.color\").attr(\"height\"))])\n          ;\n      }\n      else\n      {\n        self.legend_scale = d3.scale.ordinal()\n          .domain(self.options.uniqueValues.reverse())\n          .rangePoints([0, parseInt(self.legend_layer.select(\"rect.color\").attr(\"height\"))])\n          ;\n      }\n      self.legend_axis = d3.svg.axis().scale(self.legend_scale).orient(\"right\");\n      self.legend_axis_layer\n        .attr(\"transform\", \"translate(\" + parseInt(self.legend_layer.select(\"rect.color\").attr(\"width\")) + \",0)\")\n        .call(self.legend_axis)\n        ;\n\n      // Need to re-assign fill style to get around this firefox bug: https://bugzilla.mozilla.org/show_bug.cgi?id=652991\n      // It only seems to affect fill gradients and only when the URI changes, like it does for us with bookmarking.\n      var colorbar = self.legend_layer.select(\"rect.color\")\n        .style(\"fill\", \"url(#color-gradient)\")\n        ;\n    }\n\n    if(self.updates[\"update_label\"])\n    {\n      self.legend_layer.selectAll(\".label\").remove();\n\n      var rectHeight = parseInt(self.legend_layer.select(\"rect.color\").attr(\"height\"));\n      var x = -15;\n      var y = rectHeight/2;\n      \n      self.legend_layer.append(\"text\")\n        .attr(\"class\", \"label\")\n        .attr(\"x\", x)\n        .attr(\"y\", y)\n        .attr(\"transform\", \"rotate(-90,\" + x +\",\" + y + \")\")\n        .style(\"text-anchor\", \"middle\")\n        .style(\"font-weight\", \"bold\")\n        .text(self.options.label)\n        ;\n    }\n\n    self.updates = {}\n  },\n});","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\n////////////////////////////////////////////////////////////////////////////////////////\n// Slickgrid-based data table widget, for use with the timeseries model.\n\nimport d3 from \"js/d3.min\";\nimport \"js/jquery.event.drag-2.2\";\nimport \"js/slick.core\";\nimport \"js/slick.grid\";\nimport \"js/slick.rowselectionmodel\";\nimport \"js/slick.headerbuttons\";\nimport \"js/slick.autotooltips\";\nimport * as chunker from \"./chunker\";\n\n$.widget(\"timeseries.table\",\n{\n  options:\n  {\n    api_root : \"\",\n    mid : null,\n    aid : null,\n    metadata : null,\n    \"row-selection\" : [],\n    \"variable-selection\": [],\n    \"sort-variable\" : null,\n    \"sort-order\" : null,\n    colormap : null,\n    colorscale : null,\n    table_filter : [],\n    waveform_indexes : [],\n    selection : null,\n    row_count : null,\n    image_columns : [],\n  },\n\n  _create: function()\n  {\n  \tvar self = this;\n\n  \tfunction value_formatter(value)\n    {\n      return value == null ? \"&nbsp;\" : (value + \"\").replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\");\n    }\n\n  \tfunction cell_formatter(row, cell, value, columnDef, dataContext)\n    {\n      if(columnDef.colorscale) {\n        return \"<div class='highlightWrapper\" + (value==null ? \" null\" : \"\") + ( d3.hcl(columnDef.colorscale(value)).l > 50 ? \" light\" : \" dark\") + \"' style='background:\" + columnDef.colorscale(value) + \"'>\" + value_formatter(value) + \"</div>\";\n      }\n      else if(value==null)\n        return \"<div class='highlightWrapper\" + (value==null ? \" null\" : \"\") + \"'>\" + value_formatter(value) + \"</div>\";\n      return value_formatter(value);\n    }\n\n  \tfunction make_column(column_index, header_class, cell_class)\n    {\n      var column = {\n        id : column_index,\n        field : column_index,\n        name : self.options.metadata[\"column-names\"][column_index],\n        sortable : false,\n        headerCssClass : header_class,\n        cssClass : cell_class,\n        formatter : cell_formatter,\n        header :\n        {\n          buttons :\n          [\n            {\n              cssClass : self.options[\"sort-variable\"] == column_index ? (self.options[\"sort-order\"] == \"ascending\" ? \"icon-sort-ascending\" : \"icon-sort-descending\") : \"icon-sort-off\",\n              tooltip : self.options[\"sort-variable\"] == column_index ? (self.options[\"sort-order\"] == \"ascending\" ? \"Sort descending\" : \"Sort ascending\") : \"Sort ascending\",\n              command : self.options[\"sort-variable\"] == column_index ? (self.options[\"sort-order\"] == \"ascending\" ? \"sort-descending\" : \"sort-ascending\") : \"sort-ascending\"\n            }\n          ]\n        }\n      };\n\n      // Special options for image columns\n      if( self.options.image_columns.indexOf(column_index) > -1 ) {\n        column.headerCssClass += \" headerImage\";\n      }\n\n      return column;\n    }\n\n    self.columns = [];\n    var header_class, cell_class;\n    // Last column is added as simid\n    self.columns.push(make_column(self.options.metadata[\"column-count\"]-1, \"headerSimId\", \"rowSimId\"));\n    // rest of columns are added as inputs, except for media columns which are added as other\n    for(var i = 0; i < self.options.metadata[\"column-count\"]-1; i++)\n    {\n      header_class = \"headerInput\";\n      cell_class = \"rowInput\";\n      if(self.options.image_columns.indexOf(i) > -1)\n      {\n        header_class = \"headerOther\";\n        cell_class = \"rowOther\";\n      }\n      self.columns.push(make_column(i, header_class, cell_class));\n    }\n  },\n\n  resize_canvas: function()\n  {\n    var self = this;\n    self.grid.resizeCanvas();\n  },\n\n  _setOption: function(key, value)\n  {\n    function set_sort(column, order)\n    {\n      self.options[\"sort-variable\"] = column;\n      self.options[\"sort-order\"] = order;\n      self.data.set_sort(column, order, function(){\n        if(self.options[\"row-selection\"].length > 0){\n          var selectedRows = self.data.getSimulationRowIndexes(self.options[\"row-selection\"]);\n          self.trigger_row_selection = false;\n          self.grid.setSelectedRows(selectedRows);\n          self.grid.resetActiveCell();\n          if(selectedRows.length)\n            self.grid.scrollRowToTop(Math.min.apply(Math, selectedRows));\n        }\n      });\n      self.element.trigger(\"variable-sort-changed\", [column, order]);\n    }\n\n    var self = this;\n\n    if(key == \"row-selection\")\n    {\n      // Unexpectedly at this point self.options[key] has already been set to value, so this always returns even when the row-selection is unique\n      //if(self._array_equal(self.options[key], value))\n      //  return;\n\n      self.options[key] = value;\n\n      var selectedRows = self.data.getSimulationRowIndexes(self.options[\"row-selection\"]);\n      self.trigger_row_selection = false;\n      self.grid.setSelectedRows(selectedRows);\n      self.grid.resetActiveCell();\n      if(selectedRows.length)\n        self.grid.scrollRowToTop(Math.min.apply(Math, selectedRows));\n    }\n    else if(key == \"row-selection-silent\")\n    {\n      self.options[\"row-selection\"] = value;\n    }\n    else if(key == \"variable-selection\")\n    {\n      if(self._array_equal(self.options[key], value))\n        return;\n\n      self.options[key] = value;\n      self._color_variables(value);\n    }\n    else if(key == \"colorscale\")\n    {\n      self.options[key] = value;\n      self._color_variables(self.options[\"variable-selection\"]);\n    }\n    else if(key == \"selection\")\n    {\n      self.options[key] = value;\n\n      var data_table_index, waveform_index;\n      var table_filter = [];\n      var waveform_indexes = [];\n      $.each(value, function(index, node)\n      {\n        data_table_index = node[\"data-table-index\"];\n        waveform_index   = node[\"waveform-index\"];\n\n        if(data_table_index == null)\n          return;\n\n        table_filter.push(data_table_index);\n        waveform_indexes.push(waveform_index);\n      });\n      self.options.table_filter = table_filter;\n      self.options.waveform_indexes = waveform_indexes;\n      self.options.row_count = table_filter.length;\n\n      function initialize_grid(indices){\n\n        var sorted_table_filter = undefined;\n        var retrieve_table_filter = undefined;\n\n        if(indices !== undefined)\n        {\n          var sorted_rows = [];\n          // Reverse response indexes for descending sort order\n          if(self.options[\"sort-order\"] == 'descending')\n          {\n            var plain_array = [];\n            for(var i=0; i<indices.length; i++)\n            {\n              plain_array.push(indices[i]);\n            }\n            indices = plain_array.reverse();\n          }\n          var response = []; \n          for(var i = 0; i < self.options.table_filter.length; i++)\n          {\n            response.push( indices.indexOf(self.options.table_filter[i]) );\n          }\n          sorted_rows = new Int32Array(response);\n\n          if(sorted_rows.length > 1)\n            sorted_table_filter = Array.apply( [], sorted_rows );\n          else\n            sorted_table_filter = [sorted_rows[0]];\n          retrieve_table_filter = sorted_table_filter.slice(0).sort(function (a, b) { return a - b });\n        }\n\n        self.data = new self._data_provider({\n          api_root : self.options.api_root,\n          mid : self.options.mid,\n          aid : self.options.aid,\n          metadata : self.options.metadata,\n          sort_column : self.options[\"sort-variable\"],\n          sort_order : self.options[\"sort-order\"],\n          table_filter : self.options.table_filter,\n          row_count : self.options.row_count,\n          sorted_table_filter : sorted_table_filter,\n          retrieve_table_filter : retrieve_table_filter\n          });\n\n        if(self.grid) {\n          self.grid.setData(self.data);\n          self.data.setGrid(self.grid);\n          self.grid.invalidate();\n          if(self.options[\"row-selection\"].length > 0){\n            var selectedRows = self.data.getSimulationRowIndexes(self.options[\"row-selection\"]);\n            self.trigger_row_selection = false;\n            self.grid.setSelectedRows(selectedRows);\n            self.grid.resetActiveCell();\n            if(selectedRows.length)\n              self.grid.scrollRowToTop(Math.min.apply(Math, selectedRows));\n          }\n        }\n        else {\n          self.trigger_row_selection = true;\n          self.grid = new Slick.Grid(self.element, self.data, self.columns, {explicitInitialization : true, enableColumnReorder : false});\n          self.data.setGrid(self.grid);\n\n          var header_buttons = new Slick.Plugins.HeaderButtons();\n          header_buttons.onCommand.subscribe(function(e, args)\n          {\n            var column = args.column;\n            var button = args.button;\n            var command = args.command;\n            var grid = args.grid;\n\n            for(var i in self.columns)\n            {\n              self.columns[i].header.buttons[0].cssClass = \"icon-sort-off\";\n              self.columns[i].header.buttons[0].tooltip = \"Sort ascending\";\n              self.columns[i].header.buttons[0].command = \"sort-ascending\";\n              grid.updateColumnHeader(self.columns[i].id);\n            }\n\n            if(command == \"sort-ascending\")\n            {\n              button.cssClass = 'icon-sort-ascending';\n              button.command = 'sort-descending';\n              button.tooltip = 'Sort descending';\n              set_sort(column.id, \"ascending\");\n            }\n            else if(command == \"sort-descending\")\n            {\n              button.cssClass = 'icon-sort-descending';\n              button.command = 'sort-ascending';\n              button.tooltip = 'Sort ascending';\n              set_sort(column.id, \"descending\");\n            }\n          });\n\n          self.grid.registerPlugin(header_buttons);\n          self.grid.registerPlugin(new Slick.AutoTooltips({enableForHeaderCells:true}));\n\n          self.grid.setSelectionModel(new Slick.RowSelectionModel());\n\n          self.grid.onSelectedRowsChanged.subscribe(function(e, selection)\n          {\n            // Don't trigger a selection event unless the selection was changed by user interaction (i.e. not outside callers or changing the sort order).\n            if(self.trigger_row_selection)\n            {\n              var waveform_indexes=[];\n              for(var i=0; i<selection.rows.length; i++){\n                waveform_indexes.push( self.grid.getDataItem(selection.rows[i])[self.options.metadata[\"column-count\"]-1] );\n              }\n              self.options[\"row-selection\"] = waveform_indexes;\n              self.element.trigger(\"row-selection-changed\", [waveform_indexes]);\n            }\n            self.trigger_row_selection = true;\n          });\n\n          self.grid.onHeaderClick.subscribe(function (e, args)\n          {\n            if(!self._array_equal([args.column.field], self.options[\"variable-selection\"]) &&\n               self.options.image_columns.indexOf(args.column.field) == -1\n              )\n            {\n              self.options[\"variable-selection\"] = [args.column.field];\n              // self._color_variables(self.options[\"variable-selection\"]);\n              self.element.trigger(\"variable-selection-changed\", { variable:self.options[\"variable-selection\"], colorscale:args.column.colorscale, });\n            }\n          });\n\n          self._color_variables(self.options[\"variable-selection\"]);\n\n          self.grid.init();\n\n          if(self.options[\"row-selection\"].length > 0){\n            var selectedRows = self.data.getSimulationRowIndexes(self.options[\"row-selection\"]);\n            self.trigger_row_selection = false;\n            self.grid.setSelectedRows(selectedRows);\n            self.grid.resetActiveCell();\n            if(selectedRows.length)\n              self.grid.scrollRowToTop(Math.min.apply(Math, selectedRows));\n          }\n        }\n\n        self.data.onDataLoaded.subscribe(function (e, args) {\n          for (var i = args.from; i <= args.to; i++) {\n            self.grid.invalidateRow(i);\n          }\n          self.grid.render();\n        });\n      }\n\n      if(self.options[\"sort-variable\"] !== null && self.options[\"sort-order\"] !== null && self.options.table_filter.length > 0) {\n        // Need to retrieve the sorted_table_filter first because everything else relies on it.\n\n        if( self.options[\"sort-variable\"] == self.options.metadata[\"column-count\"]-1 )\n        {\n          // we are sorting by the index column, so we can just make the data we need.\n          initialize_grid( new Int32Array( d3.range(self.options.metadata[\"row-count\"]) ) );\n        }\n        else\n        {\n          var request = new XMLHttpRequest();\n          request.open(\"GET\", self.options.api_root + \"models/\" + self.options.mid + \"/arraysets/\" + self.options.aid + \"/data?hyperchunks=0/rank(a\" + self.options[\"sort-variable\"] + ',\"asc\")/...&byteorder=' + (chunker.is_little_endian() ? \"little\" : \"big\") );\n          request.responseType = \"arraybuffer\";\n          request.onload = function(e)\n          {\n            var indices = [];\n            var data = new Int32Array(this.response);\n            // Filtering out every other element in the reponse array, because it's full of extraneous 0 (zeros) for some reason.\n            // Need to figure out why, but this is a fix for now.\n            for(var i=0; i<data.length; i=i+2)\n            {\n              indices.push(data[i]);\n            }\n            indices = new Int32Array(indices);\n\n            initialize_grid(indices);\n          }\n          request.send();\n        }\n      }\n      else\n      {\n        initialize_grid();\n      }\n      \n    }\n    else if(key == \"sort-variable\")\n    {\n      self.options[key] = value;\n      if(value === null) {\n        self.options[\"sort-order\"] = null\n      }\n      set_sort(self.options[\"sort-variable\"], self.options[\"sort-order\"]);\n      // Set all column header buttons to \"sort-off\" state\n      for(var i in self.columns)\n      {\n        self.columns[i].header.buttons[0].cssClass = \"icon-sort-off\";\n        self.columns[i].header.buttons[0].tooltip = \"Sort ascending\";\n        self.columns[i].header.buttons[0].command = \"sort-ascending\";\n        self.grid.updateColumnHeader(self.columns[i].id);\n      }\n    }\n  },\n\n  _color_variables: function(variables)\n  {\n    var self = this;\n\n    var columns = self.grid.getColumns();\n    for(var i in columns)\n    {\n      var column = columns[i];\n      if(self.options.colorscale !== null && $.inArray(column.id, variables) != -1)\n      {\n        column.colorscale = self.options.colorscale;\n        column.cssClass = column.cssClass.split(\" \")[0] + \" highlight\";\n      }\n      else\n      {\n        column.colorscale = null;\n        column.cssClass = column.cssClass.split(\" \")[0];\n      }\n      // if(self.options.colormap !== null && $.inArray(column.id, variables) != -1)\n      // {\n      //   // Make a copy of our global colormap, then adjust its domain to match our column-specific data.\n      //   column.colormap = self.options.colormap.copy();\n\n      //   var new_domain = []\n      //   var domain_scale = d3.scale.linear()\n      //     .domain([0, column.colormap.range().length - 1])\n      //     .range([self.options.metadata[\"column-min\"][column.id], self.options.metadata[\"column-max\"][column.id]]);\n      //   for(var i in column.colormap.range())\n      //     new_domain.push(domain_scale(i));\n      //   column.colormap.domain(new_domain);\n\n      //   column.cssClass = column.cssClass.split(\" \")[0] + \" highlight\";\n      //   column.highlighted = true;\n      // }\n      // else\n      // {\n      //   column.colormap = null;\n      //   column.cssClass = column.cssClass.split(\" \")[0];\n      //   column.highlighted = false;\n      // }\n    }\n\n    self.grid.invalidate();\n  },\n\n  _data_provider: function(parameters)\n  {\n    var self = this;\n\n    self.api_root = parameters.api_root\n    self.mid = parameters.mid;\n    self.aid = parameters.aid;\n    self.metadata = parameters.metadata;\n    self.sort_column = parameters.sort_column;\n    self.sort_order = parameters.sort_order;\n    self.table_filter = parameters.table_filter;\n    if(parameters.sorted_table_filter == undefined)\n      self.sorted_table_filter = parameters.table_filter;\n    else\n      self.sorted_table_filter = parameters.sorted_table_filter;\n    if(parameters.retrieve_table_filter == undefined)\n      self.retrieve_table_filter = parameters.table_filter;\n    else\n      self.retrieve_table_filter = parameters.retrieve_table_filter;\n    self.row_count = parameters.row_count;\n    self.ranked_indices = {};\n\n    self.pages = {};\n    self.pages_in_progress = {};\n    self.page_size = 50;\n\n    self.onDataLoaded = new Slick.Event();\n\n    self.get_indices_old = function(sortedUnsorted, rows, callback, asynchronous)\n    {\n      if(asynchronous != false)\n        asynchronous = true;\n\n      if(rows.length == 0)\n      {\n        callback([]);\n        return;\n      }\n\n      var sort = \"\";\n      if(self.sort_column !== null && self.sort_order !== null)\n        sort = \"&sort=\" + self.sort_column + \":\" + self.sort_order;\n\n      var row_string = \"\";\n      for(var i = 0; i < rows.length; ++i)\n      {\n        row_string += rows[i];\n        break\n      }\n      for(var i = 1; i < rows.length; ++i)\n      {\n        row_string += \",\";\n        row_string += rows[i];\n      }\n\n      // XMLHttpRequest does not support synchronous retrieval with arraybuffer, so falling back to ajax with no arraybuffer for initial synchronous sorted table filter retrieval.\n      if(asynchronous){\n        var request = new XMLHttpRequest();\n        request.open(\"GET\", self.api_root + \"models/\" + self.mid + \"/tables/\" + self.aid + \"/arrays/0/\" + sortedUnsorted + \"-indices?rows=\" + row_string + \"&index=Index&byteorder=\" + (chunker.is_little_endian() ? \"little\" : \"big\") + sort);\n        request.responseType = \"arraybuffer\";\n        request.callback = callback;\n        request.onload = function(e)\n        {\n          this.callback(new Int32Array(this.response));\n        }\n        request.send();\n      } else {\n        $.ajax(\n        {\n          type : \"GET\",\n          url : self.api_root + \"models/\" + self.mid + \"/tables/\" + self.aid + \"/arrays/0/\" + sortedUnsorted + \"-indices?rows=\" + row_string + \"&index=Index\" + sort,\n          async : false,\n          callback : callback,\n          success : function(data)\n          {\n            this.callback(new Int32Array(data));\n          },\n        });\n      }\n    }\n\n    self.get_indices = function(direction, rows, callback)\n    {\n      if(rows.length == 0)\n      {\n        callback([]);\n        return;\n      }\n      // We have no sort column or order, so just returning the same rows as were asked for since they're in the same order\n      if(self.sort_column == null || self.sort_order == null)\n      {\n        callback(rows);\n      }\n      else\n      {\n        if(self.ranked_indices[self.sort_column])\n        {\n          // we have data for this column, so figure out what to return\n          var indices = self.ranked_indices[self.sort_column];\n          // Reverse response indexes for descending sort order\n          if(self.sort_order == 'descending')\n          {\n            var plain_array = [];\n            for(var i=0; i<indices.length; i++)\n            {\n              plain_array.push(indices[i]);\n            }\n            indices = plain_array.reverse();\n          }\n          var response = []; \n          for(var i=0; i<rows.length; i++)\n          {\n            if(direction == \"unsorted\")\n            {\n              response.push( indices[ rows[i] ] );\n            }\n            else if(direction == \"sorted\")\n            {\n              response.push( indices.indexOf(rows[i]) );\n            }\n          }\n          callback(new Int32Array(response));\n        }\n        else\n        {\n          if( self.sort_column == self.metadata[\"column-count\"]-1 )\n          {\n            // we are sorting by the index column, so we can just make the data we need.\n            self.ranked_indices[self.sort_column] = new Int32Array( d3.range(self.metadata[\"row-count\"]) );\n            self.get_indices(direction, rows, callback);\n          }\n          else\n          {\n            // we have no data for this column, so go retrieve it and call this function again.\n            var request = new XMLHttpRequest();\n            request.open(\"GET\", self.api_root + \"models/\" + self.mid + \"/arraysets/\" + self.aid + \"/data?hyperchunks=0/rank(a\" + self.sort_column + ',\"asc\")/...&byteorder=' + (chunker.is_little_endian() ? \"little\" : \"big\") );\n            request.responseType = \"arraybuffer\";\n            request.direction = direction;\n            request.rows = rows;\n            request.callback = callback;\n            request.onload = function(e)\n            {\n              var indices = [];\n              var data = new Int32Array(this.response);\n              // Filtering out every other element in the reponse array, because it's full of extraneous 0 (zeros) for some reason.\n              // Need to figure out why, but this is a fix for now.\n              for(var i=0; i<data.length; i=i+2)\n              {\n                indices.push(data[i]);\n              }\n              self.ranked_indices[self.sort_column] = new Int32Array(indices);\n              self.get_indices(this.direction, this.rows, this.callback);\n            }\n            request.send();\n          }\n        }\n      }\n    }\n\n    self.setGrid = function(grid)\n    {\n      self.grid = grid;\n    }\n\n    self.getLength = function()\n    {\n      return self.row_count;\n    }\n\n    self.getItem_old = function(index)\n    {\n      var column_begin = 0;\n      var column_end = self.metadata[\"column-count\"];\n      var page = Math.floor(index / self.page_size);\n      var page_begin = page * self.page_size;\n\n      if(!(page in self.pages))\n      {\n        var row_begin = page_begin;\n        var row_end = (page + 1) * self.page_size;\n\n        var sort = \"\";\n        if(self.sort_column !== null && self.sort_order !== null) {\n          sort = \"&sort=\" + self.sort_column + \":\" + self.sort_order;\n        }\n        \n        var rowsToRetrieve = self.retrieve_table_filter.slice(row_begin, row_end ).join(',');\n\n        $.ajax(\n        {\n          type : \"GET\",\n          url : self.api_root + \"models/\" + self.mid + \"/tables/\" + self.aid + \"/arrays/0/chunk?rows=\" + rowsToRetrieve + \"&columns=\" + column_begin + \"-\" + column_end + \"&index=Index\" + sort,\n          async : false,\n          success : function(data)\n          {\n            self.pages[page] = data;\n          },\n          error: function(request, status, reason_phrase)\n          {\n            console.log(\"error\", request, status, reason_phrase);\n          }\n        });\n      }\n\n      var result = {};\n      for(var i = column_begin; i != column_end; ++i)\n        result[i] = self.pages[page].data[i][index - page_begin];\n      return result;\n    }\n\n    self.getItem = function(index)\n    {\n      var column_begin = 0;\n      var column_end = self.metadata[\"column-count\"];\n      var page = Math.floor(index / self.page_size);\n      var page_begin = page * self.page_size;\n\n      if(self.pages_in_progress[page])\n      {\n        return null;\n      }\n\n      if(!(page in self.pages))\n      {\n        self.pages_in_progress[page] = true;\n        var row_begin = page_begin;\n        var row_end = (page + 1) * self.page_size;\n\n        var rowsToRetrieve = self.retrieve_table_filter.slice(row_begin, row_end ).join('|');\n\n        var sort = \"\";\n        if(self.sort_column !== null && self.sort_order !== null)\n        {\n          var sort_column = \"a\" + self.sort_column;\n          var sort_order = self.sort_order;\n          if(sort_order == 'ascending')\n          {\n            sort_order = 'asc';\n          }\n          else if(sort_order == 'descending')\n          {\n            sort_order = 'desc';\n          }\n          if(self.sort_column == self.metadata[\"column-count\"]-1)\n            sort_column = \"index(0)\";\n          sort = \"/order: rank(\" + sort_column + ', \"' + sort_order + '\")';\n        }\n\n        $.ajax(\n        {\n          type : \"GET\",\n          url : self.api_root + \"models/\" + self.mid + \"/arraysets/\" + self.aid + \"/data?hyperchunks=0/\" + column_begin + \":\" + (column_end - 1) + \"|index(0)\" + sort + \"/\" + rowsToRetrieve,\n          success : function(data)\n          {\n            self.pages[page] = [];\n            var columns = column_end - column_begin;\n            var rows = data.length / columns;\n            for(var row = 0; row < rows; row++)\n            {\n              var result = {};\n              for(var column = column_begin; column != column_end; ++column)\n              {\n                result[column] = data[  ((column - column_begin) * rows) + row  ];\n              }\n              self.pages[page].push(result);\n            }\n            self.pages_in_progress[page] = false;\n            self.onDataLoaded.notify({from: row_begin, to: row_end});\n          },\n          error: function(request, status, reason_phrase)\n          {\n            console.log(\"error\", request, status, reason_phrase);\n          }\n        });\n        return null;\n      }\n\n      return self.pages[page][index - page_begin];\n    }\n\n    self.getItemMetadata = function(index)\n    {\n      return null;\n    }\n\n    self.set_sort = function(column, order, callback)\n    {\n      if(column == self.sort_column && order == self.sort_order) {\n        return;\n      }\n      else if(column==null || order==null){\n        self.sort_column = column;\n        self.sort_order = order;\n        self.sorted_table_filter = self.table_filter;\n        self.retrieve_table_filter = self.table_filter;\n        self.pages = {};\n        self.grid.invalidate();\n        callback();\n      }\n      else {\n        self.sort_column = column;\n        self.sort_order = order;\n        self.get_indices(\"sorted\", self.table_filter, function(sorted_rows){\n          if(sorted_rows.length > 1)\n            self.sorted_table_filter = Array.apply( [], sorted_rows );\n          else\n            self.sorted_table_filter = [sorted_rows[0]];\n          self.retrieve_table_filter = self.sorted_table_filter.slice(0).sort(function (a, b) { return a - b });\n          self.pages = {};\n          self.grid.invalidate();\n          callback();\n        });\n      }\n    }\n\n    self.getSimulationRowIndexes = function(simulation_indexes)\n    {\n      var table_filter_index, sorted_table_filter_element, retrieve_table_filter_index;\n      var result = [];\n      for(var i=0; i<simulation_indexes.length; i++) {\n        table_filter_index = self.table_filter.indexOf(simulation_indexes[i]);\n        if(table_filter_index > -1){\n          sorted_table_filter_element = self.sorted_table_filter[table_filter_index];\n          retrieve_table_filter_index = self.retrieve_table_filter.indexOf(sorted_table_filter_element);\n          result.push(retrieve_table_filter_index);\n        }\n      }\n      return result;\n    }\n\n  },\n\n  _array_equal: function(a, b)\n  {\n    return $(a).not(b).length == 0 && $(b).not(a).length == 0;\n  },\n});","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\n///////////////////////////////////////////////////////////////////////////////////////////\n// HTML5 DOM dendrogram control, for use with the timeseries model.\n\nimport d3 from \"js/d3.min\";\nimport * as chunker from \"./chunker\";\nimport \"bootstrap\";\n\n$.widget(\"timeseries.dendrogram\",\n{\n  options:\n  {\n  \tapi_root : \"\",\n    mid : null,\n  \tclusters:[],\n  \tcluster: 0,\n  \tcluster_data:null,\n  \tcollapsed_nodes:null,\n  \texpanded_nodes:null,\n    selected_nodes:null,\n    color_array: null,\n    color_scale: null,\n    data_table_index_array: null,\n    dendrogram_sort_order: true,\n    highlight: [],\n    image_columns : [],\n  },\n\n  _create: function()\n  {\n    this._set_cluster();\n  },\n\n  _set_cluster: function()\n  {\n  \tvar self = this;\n  \tself.container = d3.select(\"#dendrogram-viewer\");\n\n  \tvar cluster_data = this.options.cluster_data;\n  \tvar collapsed_nodes = this.options.collapsed_nodes;\n  \tvar expanded_nodes = this.options.expanded_nodes;\n    var selected_nodes = this.options.selected_nodes;\n  \tvar api_root = self.options.api_root;\n  \tvar mid = self.options.mid;\n\n  \tvar linkage = cluster_data[\"linkage\"];\n    var input_indices = cluster_data[\"input-indices\"];\n\t  var exemplars = cluster_data[\"exemplars\"];\n\t  var subtrees = [];\n\n    for(var i=0; i<input_indices.length; i++){\n      subtrees.push({\"node-index\":subtrees.length, leaves:1, exemplar:exemplars[i], selected: false, \"waveform-index\" : i, \"data-table-index\" : input_indices[i]});\n    }\n    for(var i=0; i<linkage.length; i++){\n      subtrees.push({\"node-index\":subtrees.length, children:[subtrees[linkage[i][0]], subtrees[linkage[i][1]]], leaves:linkage[i][3], exemplar:exemplars[i + input_indices.length], selected: false, \"waveform-index\" : null, \"data-table-index\" : null});\n    }\n\n    var padding = 20;\n    var diagram_width = this.element.parent().width() - padding - padding - 110;\n    var diagram_height = this.element.parent().height() - padding - padding;\n\n    var layout = d3.layout.cluster()\n\t    .size([diagram_height, diagram_width]) // Width and height are transposed here because the layout defaults top-to-buttom.\n\t    .separation(function() { return 1; })\n\t    ;\n\n\t  self.container.selectAll(\"g\").remove();\n\n    self.sortControl = $('<div id=\"dendrogram-sort-control\"></div>')\n      .appendTo('#dendrogram-pane')\n      .click(function() {\n        if(!$(this).hasClass(\"selected\")){\n          self.options.dendrogram_sort_order = true;\n          self._set_dendrogram_sort_order_state();\n          self.element.trigger(\"sort-by-dendrogram-order\");\n        }\n      })\n      ;\n\n    self.outputsButtonLabel = $('#dendrogram-controls button.outputs .buttonLabel');\n    self.outputs_items = $('#dendrogram-controls ul.outputs');\n\n    self._set_dendrogram_sort_order_state();\n    self._set_outputs();\n\n\n\t  var vis = self.container.append(\"svg:g\")\n      .attr(\"transform\", \"translate(\" + padding + \",\" + padding + \")\")\n      ;\n\n    var root = subtrees[subtrees.length - 1];\n    self.root = root;\n    root.x0 = diagram_height / 2;\n    root.y0 = 0;\n\n    // Compute the layout once for the entire tree so we can capture the max depth ...\n    var nodes = layout.nodes(root).reverse();\n    var max_depth = -1;\n    nodes.forEach(function(d) { max_depth = Math.max(max_depth, d.depth); });\n\n    // We have collapse/expand/selected node data. Let's go ahead and apply it.\n    if( (collapsed_nodes!=null) || (expanded_nodes!=null) || (selected_nodes!=null) ){\n      nodes.forEach(function(d) {\n        if(selected_nodes != null && selected_nodes.length>0) {\n          if( selected_nodes.indexOf(d[\"node-index\"]) > -1 ) {\n            d.selected = true;\n          }\n        }\n        if( collapsed_nodes && (collapsed_nodes.indexOf(d[\"node-index\"]) > -1) && d.children ) {\n          toggle(d);\n        }\n        else if ( expanded_nodes && (expanded_nodes.indexOf(d[\"node-index\"]) > -1) && d._children ) {\n          toggle(d);\n        }\n      });\n    }\n    // We have no data on expanded / collapsed nodes. Let's go ahead and just show the top four levels.\n    if( (expanded_nodes==null) && (collapsed_nodes==null) ) {\n      // Start showing the top four levels of the tree ...\n      nodes.forEach(function(d) { if(d.depth == 3) toggle(d); });\n    }\n    // We have no selected node data. Let's select the root node.\n    if(selected_nodes == null){\n      select_node(self, root, true);\n    } else {\n      // We had selected node data, so let's style them and trigger the node-selection-changed event\n      style_selected_nodes();\n      color_links();\n      // Find all selected nodes\n      var selection = [];\n      find_selected_nodes(root, selection);\n      self.element.trigger(\"node-selection-changed\", {node:null, skip_bookmarking:true, selection:selection});\n    }\n\n    // Initial update for the diagram ...\n  \tupdate_subtree(root, true);\n\n    function getNodeIndexes(nodes)\n    {\n      var node_indexes = [];\n      var node_index = null;\n\n      for(var i=0; i<nodes.length; i++)\n      {\n        node_index = nodes[i][\"node-index\"];\n        if(node_index != null)\n          node_indexes.push(node_index);\n      }\n\n      return node_indexes;\n    }\n\n\t\t// Helper function that draws dendrogram links with right-angles.\n    function path(d, i)\n    {\n      if(d.target._children) {\n        return \"M\" + d.source.y + \",\" + d.source.x + \"V\" + d.target.x + \"H\" + (diagram_width);\n      }\n      return \"M\" + d.source.y + \",\" + d.source.x + \"V\" + d.target.x + \"H\" + d.target.y;\n    }\n\n    function find_selected_nodes(d, selection)\n    {\n      if(d.selected)\n        selection.push({\"node-index\" : d[\"node-index\"], \"waveform-index\" : d[\"waveform-index\"], \"data-table-index\" : d[\"data-table-index\"]});\n      if(d.children)\n        for(var i=0; i<d.children.length; i++)\n          find_selected_nodes(d.children[i], selection);\n      if(d._children)\n        for(var i=0; i<d._children.length; i++)\n          find_selected_nodes(d._children[i], selection);\n    }\n\n    // Keeping track of already selected nodes becomes too complicated with multi selection\n    //var last_selected_node = null;\n    function select_node(context, d, skip_bookmarking)\n    {\n      // Keeping track of already selected nodes becomes too complicated with multi selection\n      // if(last_selected_node === d)\n      //   return;\n      // last_selected_node = d;\n\n      function select_subtree(d)\n      {\n        d.selected = true;\n        if(d.children)\n          for(var i=0; i<d.children.length; i++)\n            select_subtree(d.children[i]);\n        if(d._children)\n          for(var i=0; i<d._children.length; i++)\n            select_subtree(d._children[i]);\n      }\n\n      // Mark this node and all its children as selected\n      select_subtree(d);\n\n      // Sets the \"selected\" class on all selected nodes, thus coloring the circles in blue\n      style_selected_nodes();\n\n      // Colors the lines between the nodes to show what's selected\n      color_links();\n\n      // Find all selected nodes\n      var selection = [];\n      find_selected_nodes(root, selection);\n      context.options.selected_nodes = getNodeIndexes(selection);\n\n      context.element.trigger(\"node-selection-changed\", {node:d, skip_bookmarking:skip_bookmarking, selection:selection});\n    }\n\n    function unselect_node(context, d, skip_bookmarking)\n    {\n      function unselect_subtree(d)\n      {\n        d.selected = false;\n        if(d.children)\n          for(var i=0; i<d.children.length; i++)\n            unselect_subtree(d.children[i]);\n        if(d._children)\n          for(var i=0; i<d._children.length; i++)\n            unselect_subtree(d._children[i]);\n      }\n\n      // Mark this node and all its children as unselected\n      unselect_subtree(d);\n\n      // Prunes selected nodes that have been orphaned\n      prune_tree(root);\n\n      // Sets the \"selected\" class on all selected nodes, thus coloring the circles in blue\n      style_selected_nodes();\n\n      // Colors the lines between the nodes to show what's selected\n      color_links();\n\n      // Find all selected nodes\n      var selection = [];\n      find_selected_nodes(root, selection);\n      context.options.selected_nodes = getNodeIndexes(selection);\n\n      context.element.trigger(\"node-selection-changed\", {node:d, skip_bookmarking:skip_bookmarking, selection:selection});\n    }\n\n    function style_selected_nodes(){\n      self.container.selectAll(\".node\")\n        .classed(\"selected\", function(d) { return d.selected; })\n        ;\n    }\n\n\t\tfunction color_links(){\n      self.container.selectAll(\"path.link\").attr(\"style\", function(d){\n        if(checkChildren(d.target)){\n          if(d.source.selected)\n            return \"stroke: black;\"\n          else\n            return \"stroke: #646464;\"\n        }\n      });\n\n      // Checks if target or any of its children are selected\n      function checkChildren(target){\n        if(target.selected)\n          return true;\n        else if(target.children){\n          for(var i=0; i<target.children.length; i++){\n            if(checkChildren(target.children[i]))\n              return true\n          }\n        }\n        else if(target._children){\n          for(var i=0; i<target._children.length; i++){\n            if(checkChildren(target._children[i]))\n              return true\n          }\n        }\n        return false;\n      }\n    }\n\n    function prune_tree(d){\n      if(d.children || d._children) {\n        // This is a branch node\n        if(!d.selected){\n          // Branch node is unselected, so just process its children\n          if(d.children)\n            $.each(d.children,  function(index, subtree) { prune_tree(subtree); });\n          if(d._children)\n            $.each(d._children, function(index, subtree) { prune_tree(subtree); });\n          return false;\n        }\n        else {\n          //Branch node is selected, so process its children and set its selected state accordingly\n          var selected_state = false;\n          var child_selected_state = false;\n          if(d.children)\n            $.each(d.children,  function(index, subtree) {\n              child_selected_state = prune_tree(subtree);\n              selected_state = selected_state || child_selected_state;\n            });\n          if(d._children)\n            $.each(d._children, function(index, subtree) {\n              child_selected_state = prune_tree(subtree);\n              selected_state = selected_state || child_selected_state;\n            });\n          d.selected = selected_state;\n          return selected_state;\n        }\n      }\n      else {\n        // This is a leaf node\n        if(d.selected)\n          return true;\n        else\n          return false;\n      }\n    }\n\n\t\tfunction update_subtree(source, skip_bookmarking)\n    {\n      var duration = d3.event && d3.event.altKey ? 5000 : 500;\n\n      // Compute the new layout.\n      var nodes = layout.nodes(root).reverse();\n\n      // Compute the currend dendrogram depth\n      var current_depth = -1;\n      nodes.forEach(function(d) { \n        current_depth = Math.max(current_depth, d.children ? d.depth : -1); \n      });\n\n      // Normalize for current depth.\n      nodes.forEach(function(d) { \n        if(d.children || d._children)\n        {\n          d.y = d.depth * (diagram_width / (current_depth+1)); \n        }\n      });\n\n      // Update the nodes.\n      var node = vis.selectAll(\"g.node\")\n        .data(nodes, function(d) { return d[\"node-index\"]; })\n        ;\n\n      // Expand all child nodes up to a certain level, collapse all child when level is rached\n      function expandUpToLevel(d, level) {\n        if(d.children) {\n          for(var i = 0; i < d.children.length; i++) {\n            // If this child is at the correct depth and it is expanded, we collapse it\n            if(d.children[i].depth == level && d.children[i].children) {\n              toggle(d.children[i]);\n            }\n            // If this child is above the correct depth and it is collapsed, we expand it and process its children\n            else if(d.children[i].depth < level && d.children[i]._children) {\n              toggle(d.children[i]);\n              expandUpToLevel(d.children[i], level);\n            }\n            // If this child is above the correct depth and it is expanded, we just process its children\n            else if(d.children[i].depth < level && d.children[i].children) {\n              expandUpToLevel(d.children[i], level);\n            }\n          }\n        }\n        // If d has no children, we do nothing\n        else {\n          return;\n        }\n      }\n\n      // Create new nodes at the parent's previous position.\n      var node_enter = node.enter().append(\"svg:g\")\n        .attr(\"class\", \"node\")\n        .classed(\"selected\", function(d) { return d.selected; })\n        .attr(\"transform\", function(d) { return \"translate(\" + source.y0 + \",\" + source.x0 + \")\"; })\n        .style(\"opacity\", 1e-6)\n        ;\n\n      // Triangle\n      var node_subtree = node_enter.append(\"svg:g\")\n        .attr(\"class\", \"subtree\")\n        .style(\"opacity\", 1e-6)\n        .style(\"display\", function(d) { return d.leaves > 1 ? \"inline\" : \"none\"; })\n        .on(\"click\", function(d) {\n          toggle(d);\n          // Change expandThisFar to however deep below the target node you want to expand\n          var expandThisFar = 9999;\n          expandUpToLevel(d, d.depth + expandThisFar);\n          update_subtree(d);\n        })\n        ;\n\n      node_subtree.append(\"svg:path\")\n        .attr(\"class\", \"subtree-glyph\")\n        .attr(\"title\", \"Expand all\")\n        .attr(\"alt\", \"Expand all\")\n        .attr(\"d\", \"M 0 0 L 40 -13 L 40 13 Z\")\n        .style(\"fill\", \"url(#subtree-gradient)\")\n        ;\n\n      // Due to a bug in Firefox, we cannot use css to change the fill style on path.subtree-glyph from above.\n      // Instead we'll use css to display and hide this path.filled-glyph\n      node_subtree.append(\"svg:path\")\n        .attr(\"class\", \"filled-glyph\")\n        .attr(\"title\", \"Expand all\")\n        .attr(\"alt\", \"Expand all\")\n        .attr(\"d\", \"M 0 0 L 40 -13 L 40 13 Z\")\n        .style(\"fill\", \"#7767b0\")\n        ;\n\n      node_subtree.append(\"svg:text\")\n        .attr(\"x\", 28)\n        .attr(\"dy\", \".4em\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"title\", \"Expand all\")\n        .attr(\"alt\", \"Expand all\")\n        .text(function(d) { return d.leaves; })\n        ;\n\n      node_subtree.append(\"svg:text\")\n        .attr(\"x\", -9)\n        .attr(\"dy\", -5)\n        .attr(\"text-anchor\", \"middle\")\n        .text(\"+\")\n        .style(\"fill\", \"black\")\n        .on(\"click\", function(d) {\n          toggle(d);\n          // Change expandThisFar to however deep below the target node you want to expand\n          var expandThisFar = 2;\n          expandUpToLevel(d, d.depth + expandThisFar);\n          update_subtree(d);\n          d3.event.stopPropagation();\n        })\n        ;\n\n      // Circle\n      var node_glyph = node_enter.append(\"svg:g\")\n        .attr(\"class\", \"glyph\")\n        .on(\"click\", function(d) {\n          if(d3.event.ctrlKey || d3.event.metaKey) {\n            if(d.selected) {\n              unselect_node(self, d);\n            } else {\n              select_node(self, d);\n            }\n          } else {\n            // Clear previous selection if user didn't Ctrl+click\n            $.each(subtrees, function(index, subtree) { subtree.selected = false; });\n            select_node(self, d);\n          }\n        })\n        ;\n\n      node_glyph.append(\"svg:circle\")\n        .attr(\"r\", 4.5)\n        .style(\"cursor\", \"pointer\")\n        .style(\"fill\", function(d) { return d.children || d._children ? \"#dbd9eb\" : \"white\"; })\n        ;\n\n      node_glyph.append(\"svg:text\")\n        .attr(\"x\", -9)\n        .attr(\"dy\", 13)\n        .attr(\"text-anchor\", \"middle\")\n        .text(\"\")\n        .style(\"fill\", \"black\")\n        .style(\"display\", function(d) { return d._children || (!d.children && !d._children) ? \"none\" : \"inline\"; })\n        .on(\"click\", function(d) {\n          toggle(d);\n          update_subtree(d);\n          d3.event.stopPropagation();\n        })\n        ;\n\n      // Sparkline\n      var node_sparkline = node_enter.append(\"svg:g\")\n        .attr(\"class\", \"sparkline\")\n        .attr(\"transform\", function(d) { return d.leaves > 1 ? \"translate(55, 0)\" : \"translate(15, 0)\"; }) // Move sparkline to the right according to whether it's an endpoint\n        .style(\"opacity\", 1e-6)\n        .style(\"display\", \"none\")\n        ;\n\n      var node_sparkline_path = node_sparkline.append(\"svg:path\")\n        // Can't set attr here because we download waveforms asynchronously. Instead doing this below.\n        //.attr(\"d\", sparkline)\n        .style(\"stroke\", function(d, i){\n          if(self.options.color_scale !== null && self.options.color_array != null){\n            var index = d[\"data-table-index\"];\n            if(index != null) {\n              var value = self.options.color_array[index];\n              if(value != null)\n                return self.options.color_scale(value);\n              else\n                return $(\"#color-switcher\").colorswitcher(\"get_null_color\");\n            }\n            else\n              return \"black\";\n          } else {\n            return \"black\";\n          }\n        })\n        .classed(\"nullValue\", function(d, i){\n          return !(d[\"data-table-index\"] == null || (d[\"data-table-index\"] != null && self.options.color_array[d[\"data-table-index\"]] !== null));\n        })\n        .on(\"click\", function(d){\n          self._handle_highlight(d, d3.event, this);\n        })\n        ;\n      self._set_highlight();\n\n      function s_to_a(s) {\n        if (Array.isArray(s))\n          return s;\n        else\n          return JSON.parse(s);\n      }\n\n      chunker.get_model_arrayset_metadata({\n        api_root : self.options.api_root,\n        mid : self.options.mid,\n        aid : \"preview-\" + s_to_a(self.options.clusters)[self.options.cluster],\n        success : function(parameters)\n        {\n          node_sparkline_path.each(function(d,i){\n            if(d.exemplar == undefined) {\n              $(this).attr(\"d\", \"\");\n            } else {\n              chunker.get_model_arrayset({\n                api_root : self.options.api_root,\n                mid : self.options.mid,\n                aid : \"preview-\" + s_to_a(self.options.clusters)[self.options.cluster],\n                arrays : d[\"exemplar\"] + \":\" + (d[\"exemplar\"]+1),\n                element : this,\n                success : function(result, metadata, parameters)\n                {\n                  var values = result[0][\"value\"];\n                  var data = [];\n                  for(var i = 0; i != values.length; ++i) {\n                    data.push(values[i]);\n                  }\n\n                  var width = 100;\n                  var height = 15;\n                  var min = d3.min(data);\n                  var max = d3.max(data);\n                  var x = d3.scale.linear().domain([0, data.length - 1]).range([0, width]);\n                  var y = d3.scale.linear().domain([max, min]).range([-height, height]).nice();\n\n                  var path = d3.svg.line()\n                    .x(function(d,i) { return x(i); })\n                    .y(function(d) { return y(d); })\n                    ;\n\n                  $(parameters.element).attr(\"d\", path(data));\n                  //$(parameters.element).attr(\"d\", \"M 0 0 L 50 0 L 100 -5\");\n                }\n              });\n            }\n          });\n        }\n      });\n      // Set the d attribute of each sparkline path. Currently doing this by downloading each waveform individually. In the future we might want to batch it up.\n\n\n      // If we ever get the ability to download arbitrary batches of waveforms using \"GET Model Arrayset\", this is a stub-out for doing so\n      // function getWaveforms(selection){\n      //   console.log(selection);\n      //   selection.each(function(d,i){\n      //     console.log(\"exemplar is \" + d.exemplar);\n      //   });\n      // }\n      // node_enter.call(getWaveforms);\n\n      // Transition new nodes to their final position.\n      var node_update = node.transition()\n        .duration(duration)\n        .attr(\"transform\", function(d) {\n          return \"translate(\" + (d._children ? (diagram_width - 40) : d.y) + \",\" + d.x + \")\"; // Draws extended horizontal lines for collapsed nodes\n        })\n        .style(\"opacity\", 1.0)\n        ;\n\n      node_update.select(\".subtree\")\n        .style(\"opacity\", function(d) { return d._children ? 1.0 : 1e-6; })\n        .style(\"display\", function(d) { return d._children ? \"inline\" : \"none\"; })\n        ;\n\n      // Need to re-assign fill style to get around this firefox bug: https://bugzilla.mozilla.org/show_bug.cgi?id=652991\n      // It only seems to affect fill gradients and only when the URI changes, like it does for us with bookmarking.\n      node_update.select(\".subtree-glyph\")\n        .style(\"fill\", \"url(#subtree-gradient)\")\n        ;\n\n      node_update.select(\".sparkline\")\n        .style(\"opacity\", function(d) { return d._children || (!d.children && !d._children) ? 1.0 : 1e-6; })\n        .each(\"end\", function() { d3.select(this).style(\"display\", function(d) { return d._children || (!d.children && !d._children) ? \"inline\" : \"none\"; }); })\n        ;\n\n      node_update.select(\".glyph text\")\n        .style(\"display\", function(d) { return d._children || (!d.children && !d._children) ? \"none\" : \"inline\"; })\n        ;\n\n      // Transition exiting nodes to the parent's new position.\n      var node_exit = node.exit().transition()\n        .duration(duration)\n        .attr(\"transform\", function(d) { return \"translate(\" + source.y + \",\" + source.x + \")\"; })\n        .style(\"opacity\", 1e-6)\n        .remove()\n        ;\n\n      node_exit.select(\".sparkline\")\n        .each(\"start\", function() { d3.select(this).style(\"display\", \"none\"); })\n        ;\n\n      // Update the links.\n      var link = vis.selectAll(\"path.link\")\n        .data(layout.links(nodes), function(d) { return d.target[\"node-index\"]; });\n\n      // Enter any new links at the parent's previous position.\n      link.enter().insert(\"svg:path\", \"g\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", function(d)\n        {\n          var o = {x: source.x0, y: source.y0};\n          return path({source: o, target: o});\n        })\n      .transition()\n        .duration(duration)\n        .attr(\"d\", path);\n\n      // Transition new links to their new position.\n      link.transition()\n        .duration(duration)\n        .attr(\"d\", path);\n\n      // Transition exiting links to the parent's new position.\n      link.exit().transition()\n        .duration(duration)\n        .attr(\"d\", function(d)\n        {\n          var o = {x: source.x, y: source.y};\n          return path({source: o, target: o});\n        })\n        .remove()\n        ;\n\n      color_links();\n\n      // Stash the old positions for transition.\n      nodes.forEach(function(d)\n      {\n        d.x0 = d.x;\n        d.y0 = d.y;\n      });\n\n      // Bookmark expanded and collapsed nodes\n      if(!skip_bookmarking){\n        var expanded = [];\n        var collapsed = [];\n        function findExpandedAndCollapsedNodes(d){\n          // If this node is expanded, add its node-index to the expanded array\n          if(d.children) {\n            expanded.push(d[\"node-index\"]);\n            // Recursively call this function for each child to capture any collapsed and expanded ones\n            for(var i = 0; i < d.children.length; i++) {\n              findExpandedAndCollapsedNodes(d.children[i]);\n            }\n          }\n          // Otherwise if this node is collapsed, add its node-index to the collapsed array\n          else if(d._children) {\n            collapsed.push(d[\"node-index\"]);\n          }\n        }\n        findExpandedAndCollapsedNodes(root);\n        self.options.expanded_nodes = expanded;\n        self.options.collapsed_nodes = collapsed;\n        self.element.trigger(\"expanded-collapsed-nodes-changed\", {expanded:expanded, collapsed:collapsed});\n      }\n    }\n\n    // Toggle children.\n    function toggle(d)\n    {\n      if(d.children)\n      {\n        d._children = d.children;\n        d.children = null;\n      }\n      else\n      {\n        d.children = d._children;\n        d._children = null;\n      }\n\n      self.element.trigger(\"node-toggled\", d);\n    }\n  },\n\n  _set_color: function()\n  {\n    var self = this;\n\n    this.container.selectAll(\"g.sparkline path\")\n      .style(\"stroke\", function(d, i){\n        var index = d[\"data-table-index\"];\n        if(index != null) {\n          var value = self.options.color_array[index];\n          if(value != null)\n            return self.options.color_scale(value);\n          else\n            return $(\"#color-switcher\").colorswitcher(\"get_null_color\");\n        }\n        else\n          return \"black\";\n      })\n      .classed(\"nullValue\", function(d, i){\n        if (d[\"data-table-index\"] == null || (d[\"data-table-index\"] != null && self.options.color_array[d[\"data-table-index\"]] !== null))\n          return false;\n        else\n          return true;\n      })\n      ;\n  },\n\n  _set_highlight: function()\n  {\n    var self = this;\n\n    checkChildren(self.root);\n\n    this.container.selectAll(\"g.sparkline path\")\n      .classed(\"highlight\", function(d, i){\n        if(d.highlight)\n          return true;\n        else\n          return false;\n      })\n      ;\n\n    // Checks if target or any of its children are highlighted\n    function checkChildren(target){\n      var highlight = false;\n      if(target.children){\n        for(var i=0; i<target.children.length; i++){\n          if(checkChildren(target.children[i])){\n            highlight = true;\n          }\n        }\n        target.highlight = highlight;\n      }\n      else if(target._children){\n        for(var i=0; i<target._children.length; i++){\n          if(checkChildren(target._children[i])){\n            highlight = true;\n          }\n        }\n        target.highlight = highlight;\n      }\n      else if((target[\"data-table-index\"] != null) && (self.options.highlight.indexOf(target[\"data-table-index\"]) > -1)){\n        target.highlight = true;\n        highlight = true;\n      }\n      else {\n        target.highlight = false;\n        highlight = false;\n      }\n      return highlight;\n    }\n  },\n\n  _handle_highlight: function(d, event, element)\n  {\n    var self = this;\n    var data_table_indexes = getDataTableIndexesFromChildren(d);\n\n    if(!event.ctrlKey && !event.metaKey){\n      self.options.highlight = data_table_indexes;\n    }\n    else {\n      if(d.highlight){\n        for(var i=0; i < data_table_indexes.length; i++){\n          var index = self.options.highlight.indexOf(data_table_indexes[i]);\n          if (index > -1) {\n            self.options.highlight.splice(index, 1);\n          }\n        }\n      }\n      else {\n        for(var i=0; i < data_table_indexes.length; i++){\n          if(self.options.highlight.indexOf(data_table_indexes[i]) == -1)\n            self.options.highlight.push(data_table_indexes[i]);\n        }\n      }\n    }\n    self._set_highlight();\n    self.element.trigger(\"waveform-selection-changed\", [self.options.highlight]);\n\n    function getDataTableIndexesFromChildren(target){\n      var data_table_indexes = [];\n      if(target.children){\n        for(var i=0; i<target.children.length; i++){\n          if(target.children[i][\"data-table-index\"] != null)\n            data_table_indexes.push(target.children[i][\"data-table-index\"]);\n          else\n            data_table_indexes = data_table_indexes.concat(getDataTableIndexesFromChildren(target.children[i]));\n        }\n      }\n      else if(target._children){\n        for(var i=0; i<target._children.length; i++){\n          if(target._children[i][\"data-table-index\"] != null)\n            data_table_indexes.push(target._children[i][\"data-table-index\"]);\n          else\n            data_table_indexes = data_table_indexes.concat(getDataTableIndexesFromChildren(target._children[i]));\n        }\n      }\n      else if(target[\"data-table-index\"] != null)\n        data_table_indexes.push(target[\"data-table-index\"]);\n\n      return data_table_indexes;\n    }\n  },\n\n  _set_dendrogram_sort_order_state: function()\n  {\n    var self = this;\n    self.sortControl\n      .attr(\"title\", function(index, attr){return self.options.dendrogram_sort_order ? \"Inputs are sorted in dendrogram order\" : \"Sort inputs in dendrogram order\"})\n      .toggleClass(\"selected\", self.options.dendrogram_sort_order)\n      ;\n  },\n\n  _set_outputs: function()\n  {\n    var self = this;\n    self.outputs_items.empty();\n    for(var i = 0; i < self.options.clusters.length; i++) {\n      $(\"<li role='presentation'>\")\n        .toggleClass(\"active\", self.options[\"cluster\"] == i)\n        .attr(\"data-cluster\", i)\n        .appendTo(self.outputs_items)\n        .append(\n          $('<a role=\"menuitem\" tabindex=\"-1\">')\n            .html(self.options.clusters[i])\n            .click(function()\n            {\n              var menu_item = $(this).parent();\n              if(menu_item.hasClass(\"active\"))\n                return false;\n\n              self.outputs_items.find(\"li\").removeClass(\"active\");\n              menu_item.addClass(\"active\");\n\n              self.options.cluster = menu_item.attr(\"data-cluster\");\n              self.element.trigger(\"cluster-changed\", menu_item.attr(\"data-cluster\"));\n            })\n        )\n        ;\n    }\n    self.outputsButtonLabel.text(self.options.clusters[self.options[\"cluster\"]]);\n  },\n\n  resize_canvas: function()\n  {\n    this._set_cluster();\n  },\n\n  _setOption: function(key, value)\n  {\n    //console.log(\"timeseries.dendrogram._setOption()\", key, value);\n    this.options[key] = value;\n\n    if(key == \"cluster_data\")\n    {\n      this._set_cluster();\n    }\n    else if(key == \"color-options\")\n    {\n      this.options.color_array = value.color_array;\n      this.options.color_scale = value.color_scale;\n      this._set_color();\n    }\n    else if(key == \"color_scale\")\n    {\n      this._set_color();\n    }\n    else if(key == \"dendrogram_sort_order\")\n    {\n      this._set_dendrogram_sort_order_state();\n    }\n    else if(key == \"highlight\")\n    {\n      if(value == undefined)\n        this.options.highlight = [];\n      this._set_highlight();\n    }\n  }\n});","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\n///////////////////////////////////////////////////////////////////////////////////////////\n// HTML5 DOM waveform visualization, for use with the timeseries model.\n\nimport d3 from \"js/d3.min\";\nimport knob from \"jquery-knob\";\n\n$.widget(\"timeseries.waveformplot\",\n{\n  options:\n  {\n    mid : null,\n    waveforms : null, // Time & value data for all waveforms, not just the visible ones\n    selection : null, // Array of ids of waveforms that are visible\n    highlight : [],\n    color_array : null,\n    color_scale : null,\n    nullWaveformColor: \"gray\",\n    nullWaveformDasharray: \"5,5\",\n    hover : []\n  },\n\n  _create: function()\n  {\n    var self = this;\n\n    this.waveforms = this.options.waveforms;\n    this.container = d3.select(\"#waveform-viewer\");\n    this.width = $(\"#waveform-pane\").width();\n    this.height = $(\"#waveform-pane\").height();\n    this.padding_top = 20;\n    this.padding_right = 20;\n    this.padding_bottom = 40;\n    this.padding_left = 60;\n    this.diagram_width = this.width - this.padding_right - this.padding_left;\n    this.diagram_height = this.height - this.padding_top - this.padding_bottom;\n\n    this.waveformPieContainer = $(\"#waveform-progress\");\n    this.waveformPie = $(\"#waveform-progress .waveformPie\")\n    this.waveformPie.knob({\n                  'min':0,\n                  'readOnly':true,\n                  'displayInput':false,\n                  'fgColor':'#7767B0',\n                  'bgColor':'#DBD9EB',\n                  'width':200,\n                  'height':200,\n                  'thickness':0.35,\n                  'step':1,\n                });\n\n    this.waveformSelectionPieContainer = $(\"#waveform-selection-progress\");\n    this.waveformSelectionPie = $(\"#waveform-selection-progress .waveformPie\")\n    this.waveformSelectionPie.knob({\n                  'min':0,\n                  'readOnly':true,\n                  'displayInput':false,\n                  'fgColor':'#7767B0',\n                  'bgColor':'#DBD9EB',\n                  'width':200,\n                  'height':200,\n                  'thickness':0.35,\n                  'step':1,\n                });\n\n    this.waveformSelectorPieContainer = $(\"#waveform-selector-progress\");\n    this.waveformSelectorPie = $(\"#waveform-selector-progress .waveformPie\")\n    this.waveformSelectorPie.knob({\n                  'min':0,\n                  'readOnly':true,\n                  'displayInput':false,\n                  'fgColor':'#7767B0',\n                  'bgColor':'#DBD9EB',\n                  'width':15,\n                  'height':15,\n                  'thickness':0.50,\n                  'step':1,\n                });\n\n    this.waveformProcessingTimeout = { timeoutID: null };\n    this.waveformSelectionProcessingTimeout = { timeoutID: null };\n    this.previewWaveformsTimeout = null;\n    this.showWaveformPieContainerTimeout = null;\n    this.showWaveformSelectionPieContainerTimeout = null;\n    this.showWaveformSelectorPieContainerTimeout = null;\n    this.color_array = this.options.color_array;\n    this.color_scale = this.options.color_scale;\n\n    this.container.selectAll(\"canvas\").remove();\n\n    this.x_axis_layer = this.container.append(\"g\").attr(\"class\", \"x-axis\");\n    this.y_axis_layer = this.container.append(\"g\").attr(\"class\", \"y-axis\");\n\n    // this.canvas_datum = d3.select(self.element.parent().get(0)).append(\"canvas\")\n    this.canvas_datum = d3.select(self.element.parent().get(0)).insert(\"canvas\", \":first-child\")\n      .style({\n        'position':'absolute',\n        'left':this.padding_left + 'px',\n        'top':this.padding_top + 'px'\n      })\n      .node()\n      ;\n\n    // alpha true or false doesn't seem to make any difference at 15k waveforms x 1000 samples\n    this.canvas_datum_ctx = this.canvas_datum.getContext(\"2d\", {alpha:true});\n\n    this.canvas_selection = d3.select(self.element.parent().get(0)).append(\"canvas\")\n      .style({\n        'position':'absolute',\n        'left':this.padding_left + 'px',\n        'top':this.padding_top + 'px'\n      })\n      .node()\n      ;\n    this.canvas_selection_ctx = this.canvas_selection.getContext(\"2d\", {alpha:true});\n\n    this.canvas_hover = d3.select(self.element.parent().get(0)).append(\"canvas\")\n      .style({\n        'position':'absolute',\n        'left':this.padding_left + 'px',\n        'top':this.padding_top + 'px'\n      })\n      .node()\n      ;\n    this.canvas_hover_ctx = this.canvas_hover.getContext(\"2d\", {alpha:true});\n\n    this.canvas_offscreen = document.createElement('canvas');\n    this.canvas_offscreen_ctx = this.canvas_offscreen.getContext('2d', {alpha:true});\n\n    this.canvas_picker = document.createElement('canvas');\n    this.canvas_picker_ctx = this.canvas_picker.getContext('2d', {alpha:true});\n\n    function RGBtoInt(r, g, b)\n    {\n      return r<<16 | g<<8 | b;\n    }\n\n    function hover(event) {\n      var x = event.layerX;\n      var y = event.layerY;\n\n      var pixelPick = self.canvas_picker_ctx.getImageData(x, y, 1, 1);\n      var dataPick = pixelPick.data;\n      var rgbaPick = 'rgba(' + dataPick[0] + ',' + dataPick[1] +\n                 ',' + dataPick[2] + ',' + dataPick[3] + ')';\n\n      var id, isPointInStrokePick, path;\n      if(dataPick[3]==255)\n      {\n        id = RGBtoInt(dataPick[0], dataPick[1], dataPick[2]);\n        // console.log('you are hovering over waveform with id ' + id);\n\n        path = self.paths[id];\n\n        isPointInStrokePick = self.canvas_picker_ctx.isPointInStroke(path, x, y);\n\n        if(isPointInStrokePick)\n        {\n          self.options.hover = [id];\n          self._hover();\n        }\n      }\n      else\n      {\n        // Only clear hover if there is something hovered\n        if(self.options.hover.length > 0)\n        {\n          self.options.hover = [];\n          self._hover();\n        }\n      }\n\n    }\n    this.canvas_hover.addEventListener('mousemove', hover);\n\n    function click(event) {\n      // Add or remove waveform to highlights if ctrl clicked\n      if(event.ctrlKey || event.metaKey) \n      {\n        var index = self.options.highlight.indexOf(self.options.hover[0]);\n        if(index < 0)\n        {\n          self.options.highlight.push(self.options.hover[0])\n        }\n        else\n        {\n          self.options.highlight.splice(index, 1);\n          // Clear hover effect to provide feedback that waveform was removed from highlight\n          self.options.hover = [];\n          self._hover();\n        }\n      }\n      // Select only clicked waveform\n      else\n      {\n        self.options.highlight = self.options.hover.slice();\n      }\n      self._selection();\n      self.element.trigger(\"waveform-selection-changed\", [self.options.highlight]);\n      event.stopPropagation();\n    }\n    this.canvas_hover.addEventListener('click', click);\n\n    // Set all waveforms to visible if this options has not been set\n    var visible = this.options.selection;\n    if(visible === null) {\n      visible = [];\n      for(var i=0; i<this.waveforms.length; i++) {\n        visible.push(this.waveforms[i][\"input-index\"]);\n      }\n      this.options.selection = visible;\n    }\n\n    this._set_visible();\n    this._selection();\n  },\n\n  // Calculate paths\n  _calculate_paths: function()\n  {\n    var self = this;\n    var x_min = d3.min(this.waveforms, function(waveform) { return d3.min(waveform[\"time\"]); });\n    var x_max = d3.max(this.waveforms, function(waveform) { return d3.max(waveform[\"time\"]); });\n    var y_min = d3.min(this.waveforms, function(waveform) { return d3.min(waveform[\"value\"]); });\n    var y_max = d3.max(this.waveforms, function(waveform) { return d3.max(waveform[\"value\"]); });\n\n    this.x = d3.scale.linear()\n      .domain([x_min, x_max])\n      .range([0, this.diagram_width])\n      ;\n\n    this.y = d3.scale.linear()\n      .domain([y_max, y_min])\n      .range([0, this.diagram_height])\n      ;\n\n    this.paths = [];\n    var waveform, current_waveform_length, p;\n    for(var j = 0; j < this.waveforms.length; j++)\n    {\n      p = new Path2D();\n      waveform = this.waveforms[j];\n      current_waveform_length = waveform[\"time\"].length;\n\n      for(var i = 0; i != current_waveform_length; ++i)\n      {\n        p.moveTo( self.x(waveform[\"time\"][i]), self.y(waveform[\"value\"][i]) );\n        break;\n      }\n      for(var i = 1; i < current_waveform_length; ++i)\n      {\n        p.lineTo( self.x(waveform[\"time\"][i]), self.y(waveform[\"value\"][i]) );\n      }\n\n      this.paths[waveform[\"input-index\"]] = p;\n    }\n  },\n\n  // Renders waveforms\n  _set_visible: function()\n  {\n    var self = this;\n    var visible = this.options.selection;\n    this.waveforms = this.options.waveforms;\n\n    // Cancel any previously started work\n    self._stopProcessingWaveforms();\n\n    var x_min = d3.min(this.waveforms, function(waveform) { return d3.min(waveform[\"time\"]); });\n    var x_max = d3.max(this.waveforms, function(waveform) { return d3.max(waveform[\"time\"]); });\n    var y_min = d3.min(this.waveforms, function(waveform) { return d3.min(waveform[\"value\"]); });\n    var y_max = d3.max(this.waveforms, function(waveform) { return d3.max(waveform[\"value\"]); });\n\n    this.x = d3.scale.linear()\n      .domain([x_min, x_max])\n      .range([0, this.diagram_width])\n      ;\n\n    this.y = d3.scale.linear()\n      .domain([y_max, y_min])\n      .range([0, this.diagram_height])\n      ;\n\n    this.x_axis = d3.svg.axis().scale(this.x).orient(\"bottom\");\n    this.x_axis_layer\n        .attr(\"transform\", \"translate(\" + (this.padding_left - 1) + \",\" + (this.padding_top + this.diagram_height + 1) + \")\")\n        .call(this.x_axis)\n        ;\n\n    this.y_axis = d3.svg.axis().scale(this.y).orient(\"left\");\n    this.y_axis_layer\n        .attr(\"transform\", \"translate(\" + (this.padding_left - 1) + \",\" + (this.padding_top + 1) + \")\")\n        .call(this.y_axis)\n        ;\n\n    d3.selectAll(\"canvas\")\n      .attr(\"width\", this.diagram_width)\n      .attr(\"height\", this.diagram_height)\n      ;\n\n    this.canvas_offscreen.width = this.diagram_width;\n    this.canvas_offscreen.height = this.diagram_height;\n\n    this.canvas_picker.width = this.diagram_width;\n    this.canvas_picker.height = this.diagram_height;\n\n    var fillStyle = $(\"#color-switcher\").colorswitcher(\"get_background\");\n    var opacity = $(\"#color-switcher\").colorswitcher(\"get_opacity\");\n    this.canvas_hover_ctx.fillStyle = \"rgba(\" + fillStyle.r + \", \" + fillStyle.g + \", \" + fillStyle.b + \", \" + opacity + \")\";\n    this.canvas_selection_ctx.fillStyle = \"rgba(\" + fillStyle.r + \", \" + fillStyle.g + \", \" + fillStyle.b + \", \" + opacity + \")\";\n\n    var waveform_subset = [];\n    if(visible !== undefined) {\n      for(var i=0; i<visible.length; i++)\n      {\n        waveform_subset.push(self.waveforms[visible[i]])\n      }\n    }\n    else {\n      waveform_subset = self.waveforms;\n    }\n\n    function intToRGB(int)\n    {\n      var r = (int >> 16) & 0xff;\n      var g = (int >> 8) & 0xff;\n      var b = int & 0xff;\n      return d3.rgb(r, g, b);\n    }\n\n    this.canvas_offscreen_ctx.lineWidth = 1;\n    this.canvas_picker_ctx.lineWidth = 3;\n    this.canvas_hover_ctx.lineWidth = 3;\n    this.canvas_selection_ctx.lineWidth = 3;\n\n    var result, current_waveform, p, strokeStyle;\n    var color_scale_and_color_array = self.options.color_scale != null && self.options.color_array != null;\n\n    this.waveformsLength = waveform_subset.length;\n    if(this.waveformsLength > 0){\n      self.waveformPie.trigger(\n        'configure',\n        {\n          \"max\":this.waveformsLength,\n        }\n      );\n      self.waveformSelectorPie.trigger(\n        'configure',\n        {\n          \"max\":this.waveformsLength,\n        }\n      );\n\n      // Don't want the progress indicator showing up every time. Only if the delay is longer than 1 second.\n      self.showWaveformPieContainerTimeout = setTimeout(function(){\n        self.waveformPieContainer.show(0);\n      }, 1000);\n\n      this._calculate_paths();\n\n      self._timedProcessArray(\n        waveform_subset,\n        processWaveform, \n        finishedProcessingWaveforms,\n        self.waveformPie,\n        self.waveformProcessingTimeout\n      );\n      previewWaveforms(self.canvas_offscreen, self.canvas_datum_ctx);\n    }\n\n    function processWaveform(waveform){\n      var coloredLine = color_scale_and_color_array && self.options.color_array[ waveform[\"input-index\"] ] !== null;\n      if(coloredLine)\n      {\n        var strokeStyle = self.options.color_scale( self.options.color_array[ waveform[\"input-index\"] ] );\n      }\n      else\n      {\n        var strokeStyle = $(\"#color-switcher\").colorswitcher(\"get_null_color\");\n        self.canvas_offscreen_ctx.setLineDash([8, 4]);\n      }\n      self.canvas_offscreen_ctx.strokeStyle = strokeStyle;\n      self.canvas_offscreen_ctx.stroke(self.paths[ waveform[\"input-index\"] ]);\n\n      if(!coloredLine)\n      {\n        self.canvas_offscreen_ctx.setLineDash([]);\n      }\n    }\n\n    function processWaveformLookup(waveform){\n      self.canvas_picker_ctx.strokeStyle = intToRGB(waveform[\"input-index\"]);\n      self.canvas_picker_ctx.stroke(self.paths[waveform[\"input-index\"]]);\n      // console.log('just stroked lookup: ' + waveform[\"input-index\"]);\n    }\n\n    function finishedProcessingWaveformsLookup(){\n      clearTimeout(self.showWaveformSelectorPieContainerTimeout);\n      self.waveformSelectorPieContainer.hide();\n    }\n\n    function finishedProcessingWaveforms(){\n      // Cancelling the timeout that was set to delay progress indicator display\n      clearTimeout(self.showWaveformPieContainerTimeout);\n      self.waveformPieContainer.hide();\n      clearTimeout(self.previewWaveformsTimeout);\n      self.previewWaveformsTimeout = undefined;\n      self.canvas_datum_ctx.drawImage(self.canvas_offscreen, 0, 0);\n\n      // Don't want the progress indicator showing up every time. Only if the delay is longer than 1 second.\n      self.showWaveformSelectorPieContainerTimeout = setTimeout(function(){\n        self.waveformSelectorPieContainer.show(0);\n      }, 1000);\n\n      self._timedProcessArray(\n        waveform_subset,\n        processWaveformLookup, \n        finishedProcessingWaveformsLookup,\n        self.waveformSelectorPie,\n        self.waveformProcessingTimeout\n      );\n    }\n\n    function previewWaveforms(sourceCanvas, destinationContext, timeout){\n      if (timeout == null)\n        timeout = 500\n\n      self.previewWaveformsTimeout = setTimeout( function work(){\n        destinationContext.drawImage(sourceCanvas, 0, 0);\n        if(self.previewWaveformsTimeout)\n        {\n          self.previewWaveformsTimeout = setTimeout(work, timeout);\n        }\n      }, timeout );\n    }\n  },\n\n  /* Hover effect for waveforms */\n  _hover: function(waveforms)\n  {\n    var self = this;\n    var fillStyle;\n\n    // Only hover a waveform if it's part of the current selection\n    var selection = self.options.selection;\n    var hover = self.options.hover;\n    var inCurrentSelection = [];\n    for(var i=0; i<hover.length; i++){\n      if( selection.indexOf(hover[i]) > -1 ){\n        inCurrentSelection.push(hover[i]);\n      }\n    }\n    hover = inCurrentSelection;\n\n    var waveform_subset = [];\n    for(var i=0; i<hover.length; i++)\n    {\n      var node_index = hover[i];\n      if(node_index < self.waveforms.length)\n        waveform_subset.push(self.waveforms[node_index]);\n    }\n\n    // Clear the canvas\n    self.canvas_hover_ctx.clearRect(0, 0, self.canvas_hover.width, self.canvas_hover.height);\n    // Apply semi transparent background if we are displaying any waveforms\n    if(waveform_subset.length > 0)\n    {\n      self.canvas_hover_ctx.fillRect(0, 0, self.canvas_hover.width, self.canvas_hover.height);\n    }\n\n    var color_scale_and_color_array = self.options.color_scale != null && self.options.color_array != null;\n    var input_index, strokeStyle, coloredLine;\n    for(var i = 0; i < waveform_subset.length; i++)\n    {\n      input_index = waveform_subset[i][\"input-index\"];\n      coloredLine = color_scale_and_color_array && self.options.color_array[ input_index ] !== null;\n\n      if (coloredLine)\n      {\n        var strokeStyle = self.options.color_scale( self.options.color_array[ input_index ] );\n      }\n      else\n      {\n        var strokeStyle = $(\"#color-switcher\").colorswitcher(\"get_null_color\");\n        self.canvas_hover_ctx.setLineDash([8, 4]);\n      }\n\n      self.canvas_hover_ctx.strokeStyle = strokeStyle;\n      self.canvas_hover_ctx.stroke(self.paths[input_index]);\n      if(!coloredLine)\n      {\n        self.canvas_hover_ctx.setLineDash([]);\n      }\n    }\n  },\n\n  /* Highlights waveforms */\n  _selection: function(waveforms)\n  {\n    var self = this;\n\n    // Cancel any previously started work\n    self._stopProcessingWaveformsSelection();\n\n    // Only highlight a waveform if it's part of the current selection\n    var selection = self.options.selection;\n    var highlight = self.options.highlight;\n    var inCurrentSelection = [];\n    for(var i=0; i<highlight.length; i++){\n      if( selection.indexOf(highlight[i]) > -1 ){\n        inCurrentSelection.push(highlight[i]);\n      }\n    }\n    highlight = inCurrentSelection;\n\n    var waveform_subset = [];\n    for(var i=0; i<highlight.length; i++)\n    {\n      var node_index = highlight[i];\n      if(node_index < self.waveforms.length)\n        waveform_subset.push(self.waveforms[node_index]);\n    }\n\n    // Clear the canvas\n    self.canvas_selection_ctx.clearRect(0, 0, self.canvas_selection.width, self.canvas_selection.height);\n    // If we are displaying any waveforms...\n    if(waveform_subset.length > 0)\n    {\n      // Apply semi transparent background if we are displaying any waveforms\n      self.canvas_selection_ctx.fillRect(0, 0, self.canvas_hover.width, self.canvas_hover.height);\n      // Configure progress indicator max value\n      self.waveformSelectionPie.trigger(\n        'configure',\n        {\n          \"max\":waveform_subset.length,\n        }\n      );\n\n      // Don't want the progress indicator showing up every time. Only if the delay is longer than 1 second.\n      self.showWaveformSelectionPieContainerTimeout = setTimeout(function(){\n        self.waveformSelectionPieContainer.show(0);\n      }, 1000);\n\n      self._timedProcessArray(\n        waveform_subset,\n        processWaveformSelection, \n        finishedProcessingWaveformsSelection,\n        self.waveformSelectionPie,\n        self.waveformSelectionProcessingTimeout\n      );\n      //previewWaveforms(self.canvas_offscreen, self.canvas_datum_ctx);\n    } \n\n    var color_scale_and_color_array = self.options.color_scale != null && self.options.color_array != null;\n    function processWaveformSelection(waveform){\n      var coloredLine = color_scale_and_color_array && self.options.color_array[ waveform[\"input-index\"] ] !== null;\n      if(coloredLine)\n      {\n        var strokeStyle = self.options.color_scale( self.options.color_array[ waveform[\"input-index\"] ] );\n      }\n      else\n      {\n        var strokeStyle = $(\"#color-switcher\").colorswitcher(\"get_null_color\");\n        self.canvas_selection_ctx.setLineDash([8, 4]);\n      }\n      self.canvas_selection_ctx.strokeStyle = strokeStyle;\n      self.canvas_selection_ctx.stroke(self.paths[ waveform[\"input-index\"] ]);\n\n      if(!coloredLine)\n      {\n        self.canvas_selection_ctx.setLineDash([]);\n      }\n    }\n\n    function finishedProcessingWaveformsSelection(){\n      // Cancelling the timeout that was set to delay progress indicator display\n      clearTimeout(self.showWaveformSelectionPieContainerTimeout);\n      self.waveformSelectionPieContainer.hide();\n\n      // Commenting out intially to see if we can get away without previewing\n      // clearTimeout(self.previewWaveformsSelectionTimeout);\n      // self.previewSelectionWaveformsTimeout = undefined;\n      // self.canvas_datum_ctx.drawImage(self.canvas_offscreen, 0, 0);\n    }\n  },\n\n  _stopProcessingWaveforms: function()\n  {\n    var self = this;\n    // Cancel any previously started work\n    clearTimeout(self.waveformProcessingTimeout.timeoutID);\n    clearTimeout(self.previewWaveformsTimeout);\n    self.previewWaveformsTimeout = undefined;\n    clearTimeout(self.showWaveformPieContainerTimeout);\n    self.waveformPieContainer.hide();\n  },\n\n  _stopProcessingWaveformsSelection: function()\n  {\n    var self = this;\n    // Cancel any previously started work\n    clearTimeout(self.waveformSelectionProcessingTimeout.timeoutID);\n    // Commenting out intially to see if we can get away without previewing\n    // clearTimeout(self.previewWaveformsSelectionTimeout);\n    // self.previewWaveformsSelectionTimeout = undefined;\n    clearTimeout(self.showWaveformSelectionPieContainerTimeout);\n    self.waveformSelectionPieContainer.hide();\n  },\n\n  _timedProcessArray: function(items, process, callback, progressControl, windowTimer)\n  {\n    var self = this;\n    var timeout = 100; //how long to yield control to UI thread\n    var todo = items.concat(); //create a clone of the original\n\n    windowTimer.timeoutID = setTimeout(function work(){\n      var start = +new Date();\n      do {\n        process(todo.shift());\n      } while (todo.length > 0 && (+new Date() - start < 50));\n\n      if (todo.length > 0){\n        windowTimer.timeoutID = setTimeout(work, timeout);\n      } else {\n        callback(items);\n      }\n\n      progressControl.val(items.length - todo.length).trigger('change');\n    }, timeout);\n  },\n\n  resize_canvas: function()\n  {\n    this.width = $(\"#waveform-pane\").width();\n    this.height = $(\"#waveform-pane\").height();\n    this.diagram_width = this.width - this.padding_left - this.padding_right;\n    this.diagram_height = this.height - this.padding_top - this.padding_bottom;\n    this._set_visible();\n    this._selection();\n  },\n\n  _setOption: function(key, value)\n  {\n    //console.log(\"timeseries.waveform._setOption()\", key, value);\n    this.options[key] = value;\n\n    if(key == \"selection\")\n    {\n      this._set_visible();\n    }\n    else if(key == \"highlight\")\n    {\n      this._selection();\n    }\n    else if(key == \"color-options\")\n    {\n      this.options.color_array = value.color_array;\n      this.options.color_scale = value.color_scale;\n\n      this._set_visible();\n      this._selection();\n    }\n    else if(key == \"color_scale\")\n    {\n      this._set_visible();\n      this._selection();\n    }\n    else if(key == \"waveforms\")\n    {\n      this.container.selectAll(\"g.waveform\").remove();\n      this.container.selectAll(\"g.selection\").remove();\n      this.container.selectAll(\"rect.selectionMask\").remove();\n\n      this.options.waveforms = value.waveforms;\n      // Setting selection to all if it's undefined\n      if(value.selection === null) {\n        visible = [];\n        for(var i=0; i<this.options.waveforms.length; i++) {\n          visible.push(this.options.waveforms[i][\"input-index\"]);\n        }\n        this.options.selection = visible;\n      } else {\n        this.options.selection = value.selection;\n      }\n\n      // Only setting new highlight if one was passed in. Otherwise, leaving the existing one, just like the table does.\n      if(value.highlight !== undefined)\n        this.options.highlight = value.highlight;\n\n      this._set_visible();\n      this._selection();\n    }\n  },\n});","(function(e){if(typeof define===\"function\"&&define.amd){define([\"jquery\"],e)}else{e(jQuery)}})(function(e){\"use strict\";var t={},n=Math.max,r=Math.min;t.c={};t.c.d=e(document);t.c.t=function(e){return e.originalEvent.touches.length-1};t.o=function(){var n=this;this.o=null;this.$=null;this.i=null;this.g=null;this.v=null;this.cv=null;this.x=0;this.y=0;this.w=0;this.h=0;this.$c=null;this.c=null;this.t=0;this.isInit=false;this.fgColor=null;this.pColor=null;this.dH=null;this.cH=null;this.eH=null;this.rH=null;this.scale=1;this.relative=false;this.relativeWidth=false;this.relativeHeight=false;this.$div=null;this.run=function(){var t=function(e,t){var r;for(r in t){n.o[r]=t[r]}n._carve().init();n._configure()._draw()};if(this.$.data(\"kontroled\"))return;this.$.data(\"kontroled\",true);this.extend();this.o=e.extend({min:this.$.data(\"min\")!==undefined?this.$.data(\"min\"):0,max:this.$.data(\"max\")!==undefined?this.$.data(\"max\"):100,stopper:true,readOnly:this.$.data(\"readonly\")||this.$.attr(\"readonly\")===\"readonly\",cursor:this.$.data(\"cursor\")===true&&30||this.$.data(\"cursor\")||0,thickness:this.$.data(\"thickness\")&&Math.max(Math.min(this.$.data(\"thickness\"),1),.01)||.35,lineCap:this.$.data(\"linecap\")||\"butt\",width:this.$.data(\"width\")||200,height:this.$.data(\"height\")||200,displayInput:this.$.data(\"displayinput\")==null||this.$.data(\"displayinput\"),displayPrevious:this.$.data(\"displayprevious\"),fgColor:this.$.data(\"fgcolor\")||\"#87CEEB\",inputColor:this.$.data(\"inputcolor\"),font:this.$.data(\"font\")||\"Arial\",fontWeight:this.$.data(\"font-weight\")||\"bold\",inline:false,step:this.$.data(\"step\")||1,rotation:this.$.data(\"rotation\"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o);this.o.flip=this.o.rotation===\"anticlockwise\"||this.o.rotation===\"acw\";if(!this.o.inputColor){this.o.inputColor=this.o.fgColor}if(this.$.is(\"fieldset\")){this.v={};this.i=this.$.find(\"input\");this.i.each(function(t){var r=e(this);n.i[t]=r;n.v[t]=n.o.parse(r.val());r.bind(\"change blur\",function(){var e={};e[t]=r.val();n.val(n._validate(e))})});this.$.find(\"legend\").remove()}else{this.i=this.$;this.v=this.o.parse(this.$.val());this.v===\"\"&&(this.v=this.o.min);this.$.bind(\"change blur\",function(){n.val(n._validate(n.o.parse(n.$.val())))})}!this.o.displayInput&&this.$.hide();this.$c=e(document.createElement(\"canvas\")).attr({width:this.o.width,height:this.o.height});this.$div=e('<div style=\"'+(this.o.inline?\"display:inline;\":\"\")+\"width:\"+this.o.width+\"px;height:\"+this.o.height+\"px;\"+'\"></div>');this.$.wrap(this.$div).before(this.$c);this.$div=this.$.parent();if(typeof G_vmlCanvasManager!==\"undefined\"){G_vmlCanvasManager.initElement(this.$c[0])}this.c=this.$c[0].getContext?this.$c[0].getContext(\"2d\"):null;if(!this.c){throw{name:\"CanvasNotSupportedException\",message:\"Canvas not supported. Please use excanvas on IE8.0.\",toString:function(){return this.name+\": \"+this.message}}}this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1);this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf(\"%\");this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf(\"%\");this.relative=this.relativeWidth||this.relativeHeight;this._carve();if(this.v instanceof Object){this.cv={};this.copy(this.v,this.cv)}else{this.cv=this.v}this.$.bind(\"configure\",t).parent().bind(\"configure\",t);this._listen()._configure()._xy().init();this.isInit=true;this.$.val(this.o.format(this.v));this._draw();return this};this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else{this.w=this.o.width;this.h=this.o.height}this.$div.css({width:this.w+\"px\",height:this.h+\"px\"});this.$c.attr({width:this.w,height:this.h});if(this.scale!==1){this.$c[0].width=this.$c[0].width*this.scale;this.$c[0].height=this.$c[0].height*this.scale;this.$c.width(this.w);this.$c.height(this.h)}return this};this._draw=function(){var e=true;n.g=n.c;n.clear();n.dH&&(e=n.dH());e!==false&&n.draw()};this._touch=function(e){var r=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);if(t==n.cv)return;if(n.cH&&n.cH(t)===false)return;n.change(n._validate(t));n._draw()};this.t=t.c.t(e);r(e);t.c.d.bind(\"touchmove.k\",r).bind(\"touchend.k\",function(){t.c.d.unbind(\"touchmove.k touchend.k\");n.val(n.cv)});return this};this._mouse=function(e){var r=function(e){var t=n.xy2val(e.pageX,e.pageY);if(t==n.cv)return;if(n.cH&&n.cH(t)===false)return;n.change(n._validate(t));n._draw()};r(e);t.c.d.bind(\"mousemove.k\",r).bind(\"keyup.k\",function(e){if(e.keyCode===27){t.c.d.unbind(\"mouseup.k mousemove.k keyup.k\");if(n.eH&&n.eH()===false)return;n.cancel()}}).bind(\"mouseup.k\",function(e){t.c.d.unbind(\"mousemove.k mouseup.k keyup.k\");n.val(n.cv)});return this};this._xy=function(){var e=this.$c.offset();this.x=e.left;this.y=e.top;return this};this._listen=function(){if(!this.o.readOnly){this.$c.bind(\"mousedown\",function(e){e.preventDefault();n._xy()._mouse(e)}).bind(\"touchstart\",function(e){e.preventDefault();n._xy()._touch(e)});this.listen()}else{this.$.attr(\"readonly\",\"readonly\")}if(this.relative){e(window).resize(function(){n._carve().init();n._draw()})}return this};this._configure=function(){if(this.o.draw)this.dH=this.o.draw;if(this.o.change)this.cH=this.o.change;if(this.o.cancel)this.eH=this.o.cancel;if(this.o.release)this.rH=this.o.release;if(this.o.displayPrevious){this.pColor=this.h2rgba(this.o.fgColor,\"0.4\");this.fgColor=this.h2rgba(this.o.fgColor,\"0.6\")}else{this.fgColor=this.o.fgColor}return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this._validate=function(e){var t=~~((e<0?-.5:.5)+e/this.o.step)*this.o.step;return Math.round(t*100)/100};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(e){};this.val=function(e){};this.xy2val=function(e,t){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(e,t){var n;e=e.substring(1,7);n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)];return\"rgba(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\",\"+t+\")\"};this.copy=function(e,t){for(var n in e){t[n]=e[n]}}};t.Dial=function(){t.o.call(this);this.startAngle=null;this.xy=null;this.radius=null;this.lineWidth=null;this.cursorExt=null;this.w2=null;this.PI2=2*Math.PI;this.extend=function(){this.o=e.extend({bgColor:this.$.data(\"bgcolor\")||\"#EEEEEE\",angleOffset:this.$.data(\"angleoffset\")||0,angleArc:this.$.data(\"anglearc\")||360,inline:true},this.o)};this.val=function(e,t){if(null!=e){e=this.o.parse(e);if(t!==false&&e!=this.v&&this.rH&&this.rH(e)===false){return}this.cv=this.o.stopper?n(r(e,this.o.max),this.o.min):e;this.v=this.cv;this.$.val(this.o.format(this.v));this._draw()}else{return this.v}};this.xy2val=function(e,t){var i,s;i=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset;if(this.o.flip){i=this.angleArc-i-this.PI2}if(this.angleArc!=this.PI2&&i<0&&i>-.5){i=0}else if(i<0){i+=this.PI2}s=i*(this.o.max-this.o.min)/this.angleArc+this.o.min;this.o.stopper&&(s=n(r(s,this.o.max),this.o.min));return s};this.listen=function(){var t=this,i,s,o=function(e){e.preventDefault();var o=e.originalEvent,u=o.detail||o.wheelDeltaX,a=o.detail||o.wheelDeltaY,f=t._validate(t.o.parse(t.$.val()))+(u>0||a>0?t.o.step:u<0||a<0?-t.o.step:0);f=n(r(f,t.o.max),t.o.min);t.val(f,false);if(t.rH){clearTimeout(i);i=setTimeout(function(){t.rH(f);i=null},100);if(!s){s=setTimeout(function(){if(i)t.rH(f);s=null},200)}}},u,a,f=1,l={37:-t.o.step,38:t.o.step,39:t.o.step,40:-t.o.step};this.$.bind(\"keydown\",function(i){var s=i.keyCode;if(s>=96&&s<=105){s=i.keyCode=s-48}u=parseInt(String.fromCharCode(s));if(isNaN(u)){s!==13&&s!==8&&s!==9&&s!==189&&(s!==190||t.$.val().match(/\\./))&&i.preventDefault();if(e.inArray(s,[37,38,39,40])>-1){i.preventDefault();var o=t.o.parse(t.$.val())+l[s]*f;t.o.stopper&&(o=n(r(o,t.o.max),t.o.min));t.change(t._validate(o));t._draw();a=window.setTimeout(function(){f*=2},30)}}}).bind(\"keyup\",function(e){if(isNaN(u)){if(a){window.clearTimeout(a);a=null;f=1;t.val(t.$.val())}}else{t.$.val()>t.o.max&&t.$.val(t.o.max)||t.$.val()<t.o.min&&t.$.val(t.o.min)}});this.$c.bind(\"mousewheel DOMMouseScroll\",o);this.$.bind(\"mousewheel DOMMouseScroll\",o)};this.init=function(){if(this.v<this.o.min||this.v>this.o.max){this.v=this.o.min}this.$.val(this.v);this.w2=this.w/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2*this.scale;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+\"px\",height:(this.w/3>>0)+\"px\",position:\"absolute\",\"vertical-align\":\"middle\",\"margin-top\":(this.w/3>>0)+\"px\",\"margin-left\":\"-\"+(this.w*3/4+2>>0)+\"px\",border:0,background:\"none\",font:this.o.fontWeight+\" \"+(this.w/e>>0)+\"px \"+this.o.font,\"text-align\":\"center\",color:this.o.inputColor||this.o.fgColor,padding:\"0px\",\"-webkit-appearance\":\"none\"})||this.i.css({width:\"0px\",visibility:\"hidden\"})};this.change=function(e){this.cv=e;this.$.val(this.o.format(e))};this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.arc=function(e){var t,n;e=this.angle(e);if(this.o.flip){t=this.endAngle+1e-5;n=t-e-1e-5}else{t=this.startAngle-1e-5;n=t+e+1e-5}this.o.cursor&&(t=n-this.cursorExt)&&(n=n+this.cursorExt);return{s:t,e:n,d:this.o.flip&&!this.o.cursor}};this.draw=function(){var e=this.g,t=this.arc(this.cv),n,r=1;e.lineWidth=this.lineWidth;e.lineCap=this.lineCap;if(this.o.bgColor!==\"none\"){e.beginPath();e.strokeStyle=this.o.bgColor;e.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,true);e.stroke()}if(this.o.displayPrevious){n=this.arc(this.v);e.beginPath();e.strokeStyle=this.pColor;e.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d);e.stroke();r=this.cv==this.v}e.beginPath();e.strokeStyle=r?this.o.fgColor:this.fgColor;e.arc(this.xy,this.xy,this.radius,t.s,t.e,t.d);e.stroke()};this.cancel=function(){this.val(this.v)}};e.fn.dial=e.fn.knob=function(n){return this.each(function(){var r=new t.Dial;r.o=n;r.$=e(this);r.run()}).parent()}})","/* Copyright (c) 2013, 2018 National Technology and Engineering Solutions of Sandia, LLC . Under the terms of Contract  DE-NA0003525 with National Technology and Engineering Solutions of Sandia, LLC, the U.S. Government  retains certain rights in this software. */\n\nimport d3 from \"js/d3.min\";\nimport \"jquery-ui\";\n\n$.widget(\"slycat.colorswitcher\",\n{\n  options:\n  {\n    colormap : \"day\",\n  },\n\n  _create: function()\n  {\n    var self = this;\n\n    this.color_maps =\n    {\n      \"night\":\n      {\n        \"label\": \"Night\",\n        \"background\": d3.rgb(128, 128, 128),\n        \"null_color\": \"rgb(75,75,75)\",\n        \"opacity\": \"0.5\",\n        \"colors\":\n        [\n          d3.rgb( 59,  76, 192),\n          d3.rgb( 68,  90, 204),\n          d3.rgb( 77, 104, 215),\n          d3.rgb( 87, 117, 225),\n          d3.rgb( 98, 130, 234),\n          d3.rgb(108, 142, 241),\n          d3.rgb(119, 154, 247),\n          d3.rgb(130, 165, 251),\n          d3.rgb(141, 176, 254),\n          d3.rgb(152, 185, 255),\n          d3.rgb(163, 194, 255),\n          d3.rgb(174, 201, 253),\n          d3.rgb(184, 208, 249),\n          d3.rgb(194, 213, 244),\n          d3.rgb(204, 217, 238),\n          d3.rgb(213, 219, 230),\n          d3.rgb(221, 221, 221),\n          d3.rgb(229, 216, 209),\n          d3.rgb(236, 211, 197),\n          d3.rgb(241, 204, 185),\n          d3.rgb(245, 196, 173),\n          d3.rgb(247, 187, 160),\n          d3.rgb(247, 177, 148),\n          d3.rgb(247, 166, 135),\n          d3.rgb(244, 154, 123),\n          d3.rgb(241, 141, 111),\n          d3.rgb(236, 127,  99),\n          d3.rgb(229, 112,  88),\n          d3.rgb(222,  96,  77),\n          d3.rgb(213,  80,  66),\n          d3.rgb(203,  62,  56),\n          d3.rgb(192,  40,  47),\n          d3.rgb(180,   4,  38),\n        ]\n      },\n    \"day\":\n      {\n        \"label\": \"Day\",\n        \"background\": d3.rgb(255, 255, 255),\n        \"null_color\": \"gray\",\n        \"opacity\": \"0.7\",\n        \"colors\":\n        [\n          d3.rgb(100, 108, 234),\n          d3.rgb(115, 118, 240),\n          d3.rgb(128, 128, 244),\n          d3.rgb(140, 138, 248),\n          d3.rgb(151, 147, 250),\n          d3.rgb(161, 155, 251),\n          d3.rgb(169, 163, 251),\n          d3.rgb(177, 170, 250),\n          d3.rgb(184, 177, 248),\n          d3.rgb(189, 182, 245),\n          d3.rgb(193, 187, 241),\n          d3.rgb(197, 191, 236),\n          d3.rgb(199, 194, 230),\n          d3.rgb(200, 196, 224),\n          d3.rgb(201, 198, 216),\n          d3.rgb(200, 199, 208),\n          d3.rgb(198, 198, 198),\n          d3.rgb(210, 197, 195),\n          d3.rgb(220, 194, 192),\n          d3.rgb(229, 191, 187),\n          d3.rgb(236, 186, 181),\n          d3.rgb(243, 181, 175),\n          d3.rgb(248, 175, 168),\n          d3.rgb(251, 168, 160),\n          d3.rgb(254, 159, 152),\n          d3.rgb(255, 150, 143),\n          d3.rgb(255, 140, 133),\n          d3.rgb(253, 129, 123),\n          d3.rgb(250, 117, 112),\n          d3.rgb(246, 105, 101),\n          d3.rgb(240,  91,  90),\n          d3.rgb(233,  75,  78),\n          d3.rgb(225,  57,  66),\n        ]\n      },\n    \"rainbow\":\n      {\n        \"label\": \"Rainbow Night\",\n        \"background\": d3.rgb(128, 128, 128),\n        \"null_color\": \"rgb(75,75,75)\",\n        \"opacity\": \"0.6\",\n        \"colors\":\n        [\n          d3.rgb(0, 0, 255),\n          d3.rgb(0, 255, 255),\n          d3.rgb(255, 255, 0),\n          d3.rgb(255, 0, 0),\n        ]\n      },\n    \"rainbow_day\":\n      {\n        \"label\": \"Rainbow Day\",\n        \"background\": d3.rgb(255, 255, 255),\n        \"null_color\": \"gray\",\n        \"opacity\": \"0.7\",\n        \"colors\":\n        [\n          d3.rgb(0, 0, 255),\n          d3.rgb(0, 255, 255),\n          d3.rgb(255, 255, 0),\n          d3.rgb(255, 0, 0),\n        ]\n      },\n    };\n\n    this.button = $('<button class=\"btn btn-xs btn-default dropdown-toggle\" type=\"button\" id=\"colors-dropdown\" data-toggle=\"dropdown\" aria-expanded=\"true\" title=\"Line Color Theme\"> \\\n          Colors \\\n          <span class=\"caret\"></span> \\\n        </button>')\n      .appendTo(this.element)\n      ;\n    this.list = $('<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"colors-dropdown\">')\n      .appendTo(this.element)\n      ;\n    $.each(this.color_maps, function(key, value)\n    {\n      var gradient_data = self.get_gradient_data(key);\n      var color_stops = [];\n      for(var i = 0; i < gradient_data.length; i++)\n      {\n        color_stops.push( gradient_data[i].color + \" \" + gradient_data[i].offset + \"%\" );\n      }\n      var background_color = self.get_background(key);\n      var item = $('<li role=\"presentation\">')\n        .addClass(\"color\")\n        .toggleClass(\"active\", key == self.options.colormap)\n        .attr(\"data-colormap\", key)\n        .appendTo(self.list)\n        .append(\n          $('<a role=\"menuitem\" tabindex=\"-1\">')\n            .html(value.label)\n            .click(function()\n            {\n              var menu_item = $(this).parent();\n              if(menu_item.hasClass(\"active\"))\n                return false;\n\n              self.options.colormap = menu_item.attr(\"data-colormap\");\n              self.list.find(\".color\").removeClass(\"active\");\n              menu_item.addClass(\"active\");\n\n              self.element.trigger(\"colormap-changed\", [self.options.colormap]);\n            })\n            .css({\n              \"background-image\" : \"linear-gradient(to bottom, \" + color_stops.join(\", \") + \"), linear-gradient(to bottom, \" + background_color + \", \" + background_color + \")\",\n              \"background-size\" : \"5px 75%, 50px 100%\",\n              \"background-position\" : \"right 10px center, right 5px center\",\n              \"background-repeat\" : \"no-repeat, no-repeat\",\n              \"padding-right\" : \"70px\",\n            })\n        )\n        ;\n    });\n\n  },\n\n  _setOption: function(key, value)\n  {\n    //console.log(\"slycat.colorswitcher._setOption()\", key, value);\n    this.options[key] = value;\n\n    if(key == \"colormap\")\n    {\n      this.list.find(\".color\").removeClass(\"active\");\n      this.list.find(\"[data-colormap='\" + this.options.colormap + \"']\").addClass(\"active\");\n    }\n  },\n\n  // Return a d3 rgb object with the suggested background color for the given color map.\n  get_background: function(name)\n  {\n    if(name === undefined)\n      name = this.options.colormap;\n    return this.color_maps[name].background;\n  },\n\n  // Return the null color value for the given color map.\n  get_null_color: function(name)\n  {\n    if(name === undefined)\n      name = this.options.colormap;\n    return this.color_maps[name][\"null_color\"];\n  },\n\n  // Return the suggested opacity value for the given color map.\n  get_opacity: function(name)\n  {\n    if(name === undefined)\n      name = this.options.colormap;\n    return this.color_maps[name].opacity;\n  },\n\n  // Return a d3 linear color scale with the current color map for the domain [0, 1].\n  // Callers should modify the domain by passing a min and max to suit their own needs.  \n  get_color_scale: function(name, min, max)\n  {\n    if(name === undefined)\n      name = this.options.colormap;\n    if(min === undefined)\n      min = 0.0;\n    if(max === undefined)\n      max = 1.0;\n    var domain = []\n    var domain_scale = d3.scale.linear()\n      .domain([0, this.color_maps[name].colors.length-1])\n      .range([min, max]);\n    for(var i in this.color_maps[name].colors)\n      domain.push(domain_scale(i));\n    return d3.scale.linear().domain(domain).range(this.color_maps[name].colors);\n  },\n\n  // Deprecated\n  get_color_map: function(name, min, max)\n  {\n    return this.get_color_scale(name, min, max);\n  },\n\n  // Return a d3 ordinal color scale with the current color map for the domain [0, 1].\n  // Callers should modify the domain by passing an array of values to suit their own needs. \n  get_color_scale_ordinal: function(name, values)\n  {\n    if(name === undefined)\n      name = this.options.colormap;\n    if(values === undefined)\n      values = [0, 1];\n\n    var tempOrdinal = d3.scale.ordinal().domain(values).rangePoints([0, 100], 0);\n    var tempColorscale = this.get_color_scale(name, 0, 100);\n    var rgbRange = [];\n    for(var i=0; i<values.length; i++)\n    {\n      rgbRange.push( tempColorscale( tempOrdinal(values[i]) ) );\n    }\n    return d3.scale.ordinal().domain(values).range(rgbRange);\n  },\n\n  // Deprecated\n  get_color_map_ordinal: function(name, values)\n  {\n    return this.get_color_scale_ordinal(name, values);\n  },\n\n  get_gradient_data: function(name)\n  {\n    var self = this;\n\n    if(name === undefined)\n      name = this.options.colormap;\n\n    var colors = self.color_maps[name][\"colors\"];\n    var length = colors.length;\n    var data = [];\n    for(var i=0; i < length; i++){\n      data.push({offset: i*(100/(length-1)), color: colors[length-1-i],});\n    }\n    return data;\n  },\n\n  setUpColorMapsForAllColumns: function(name, columns)\n  {\n    for(var j = 0; j != columns.length; ++j)\n    {\n      columns[j].colorMap = this.get_color_scale(name, columns[j].columnMin, columns[j].columnMax);\n    }\n  }\n});"],"sourceRoot":""}